{"last_chapter_rule":"","pageList":[{"col_type":"movie_3","name":"函数","path":"hanshu","rule":"const ua1 = PC_UA;\nconst ua2 = \"netdisk;1.4.2;android-android;\";\nconst ua3 = \"netdisk;P2SP;2.2.91.136;android-android;\";\nconst cookie1 = getItem(\"cookie\"); \nconst header1 = {\n    \"User-Agent\": ua1,\n    \"Cookie\": cookie1\n};\nconst host1 = \"https://pan.baidu.com\";\n\nfunction get1(url, header) {\n    let html1 = fetch(url, {\n        headers: header,\n        method: \"GET\"\n    });\n    return JSON.parse(html1);\n}\n\nfunction setting1(input, type) {\n    if (type === \"盘内\") {\n        if (input === \"视频\") {\n            return \"select://\"+JSON.stringify({\n                \"title\": \"当前播放模式：\"+getItem(\"bdyp_play_mode1\", \"TV原画\"),\n                \"options\": [\"TV原画\", \"TV转码\"],\n                col: 1,\n                js: $.toString(()=>{\n                    setItem(\"bdyp_play_mode1\", input);\n                    toast(\"设置成功\");\n                    return \"hiker://empty\";\n                })\n            });\n        }\n    } else {\n        if (input === \"视频\") {\n            return \"select://\"+JSON.stringify({\n                \"title\": \"当前播放模式：\"+getItem(\"bdyp_play_mode2\", \"APP原画(不转存)\"),\n                \"options\": [\"APP原画(不转存)\", \"TV原画(转存)\", \"TV转码(转存)\", \"网页转码(不转存)\"],\n                col: 1,\n                js: $.toString(()=>{\n                    setItem(\"bdyp_play_mode2\", input);\n                    toast(\"设置成功\");\n                    return \"hiker://empty\";\n                })\n            });\n        }\n    }\n}\n\nfunction shouye(dir) {\n    let d = [];\n    let page = MY_PAGE;\n    let bdyp_paixu = getItem(\"bdyp_paixu\", \"↓按修改时间\");\n    if (page === 1) {\n        let d1 = [];\n        d1.push({\n            title: \"界面设置\",\n            img: \"hiker://images/icon_menu6\",\n            url: \"select://\"+JSON.stringify({\n                \"title\": \"盘内\",\n                \"options\": [\"视频\"],\n                col: 1,\n                js: $.toString(()=>{\n                    return $.require(\"hanshu\").setting1(input, \"盘内\");\n                })\n            }),\n            col_type: \"icon_2_round\"\n        });\n        d1.push({\n            title: \"账号设置\",\n            img: \"hiker://images/icon_setting6\",\n            url: $([\"网页登录\", \"扫码登录\", \"Cookie登录\", \"复制Cookie\", \"清除Cookie\"]).select(() => {\n                return $.require(\"account\").account_setting(input);\n            }),\n            col_type: \"icon_2_round\"\n        });\n        d1.push({\n            title: \"搜索\",\n            desc: \"请输入分享链接\",\n            url: $.toString(() => {\n                function match_link(input) {\n                    if (input.includes(\"baidu\")) {\n                        let path1\n                        if (input.includes(\"pwd=\")) {\n                            if (input.includes(\"/s/\")) {\n                                path1 = input.match(/([\\w_-]{23}).+pwd=(\\w+)/);\n                            } else if (input.includes(\"surl=\")) {\n                                path1 = input.match(/([\\w_-]{22}).+pwd=(\\w+)/);\n                            }\n                        } else if (input.includes(\"提取码\")) {\n                            path1 = input.match(/([\\w_-]{23})提取码:(\\w+)/);\n                        }\n                        if (path1) return path1[1]+\"?pwd=\"+path1[2];\n                    }\n                }\n                let path1 = match_link(input.replace(/\\s/g,\"\").replace(/[\\u00A0]/g,\"\"));\n                if (path1) {\n                    showLoading(\"加载中\");\n                    let data = $.require(\"hanshu\").gethtml(path1);\n                    hideLoading();\n                    return $(\"hiker://empty#page=fypage#noHistory#\").rule((data) => {\n                        $.require(\"hanshu\").search1(data);\n                    }, data);\n                }\n            }),\n            col_type: \"input\"\n        });\n        d1.push({\n            title: \"♥收藏\",\n            url: \"hiker://collection?rule=\"+MY_RULE.title,\n            col_type: \"scroll_button\"\n        }, {\n            title: \"✿历史\",\n            url: \"hiker://history?rule=\"+MY_RULE.title,\n            col_type: \"scroll_button\"\n        }, {\n            title: bdyp_paixu,\n            url: $(\"#noLoading#\").lazyRule(() => {\n                if (getItem(\"bdyp_paixu\", \"↓按修改时间\") === \"↓按修改时间\") {\n                    setItem(\"bdyp_paixu\", \"↑按修改时间\");\n                } else {\n                    setItem(\"bdyp_paixu\", \"↓按修改时间\");\n                }\n                refreshPage();\n                toast(\"设置成功\");\n                return \"hiker://empty\";\n            }),\n            col_type: \"scroll_button\"\n        });\n        setPreResult(d1);\n    }\n    let html1 = get1(host1+\"/api/list?clienttype=0&app_id=250528&web=1&order=time&desc=\"+(bdyp_paixu === \"↓按修改时间\" ? \"1\" : \"0\")+\"&dir=\"+encodeURIComponent(dir)+\"&num=100&page=1&limit=100\", header1); //log(html1)\n    if (html1.errno === 0) {\n        html1.list.forEach(it => {\n            const {isdir, category, server_filename, server_mtime, size, path} = it;\n            const longclick = [{\n                title: \"删除\",\n                js: $.toString((path) => {\n                    return $.require(\"hanshu\").shanchu(path);\n                }, path)\n            }, {\n                title: \"重命名\",\n                js: $.toString((path, server_filename) => {\n                    return $.require(\"hanshu\").rename(path, server_filename);\n                }, path, server_filename)\n            }];\n            let desc, img, url;\n            if (isdir == 1) {\n                desc = \"文件夹\"+\"  \"+formatTimestamp(server_mtime);\n                img = \"hiker://images/icon_folder3\";\n                url = $(\"hiker://empty\").rule((path) => {\n                    $.require(\"hanshu\").shouye(path);\n                }, path);\n            } else {\n                longclick.push({\n                    title: \"下载\",\n                    js: $.toString((path, category, size) => {\n                        if (category === 1 || size < 52428800) {\n                            let data = $.require(\"hanshu\").jiexi1(path, category, size);\n                            let playHeader = Object.keys(data.header).map(key => key + \"@\" + String(data.header[key]).replace(/;/g, \"；；\"));\n                            return \"download://\" + data.url + \";{\" + playHeader.join(\"&&\") + \"}\";\n                        } else if (size < 314572800) {\n                            let {jiexi1, preview_download} = $.require(\"hanshu\");\n                            let data = jiexi1(path, category, size);\n                            return preview_download(data.url);\n                        } else {\n                            toast(\"不支持下载\");\n                            return \"hiker://empty\";\n                        }\n                    }, path, category, size)\n                });\n                desc = bytesToSize(size)+\"  \"+formatTimestamp(server_mtime);\n                if (category === 1) {\n                    img = it.thumbs.url3;\n                    url = $(\"\").lazyRule((path, category, size) => {\n                        return $.require(\"hanshu\").lazy1(path, category, size);\n                    }, path, category, size);\n                } else if (category === 2) {\n                    img = \"hiker://images/icon_music3\";\n                    url = $(\"\").lazyRule((path, category, size) => {\n                        //return $.require(\"hanshu\").lazy1(path, category, size);\n                    }, path, category, size);\n                } else if (category === 3) {\n                    img = it.thumbs.url3;\n                    url = it.thumbs.url3+\"#.png\";\n                } else if (category === 4) {\n                    img = \"hiker://images/icon_txt2\";\n                    url = $(\"\").lazyRule((path, category, size) => {\n                        return $.require(\"hanshu\").lazy1(path, category, size);\n                    }, path, category, size);\n                } else if (category === 5) {\n                    img = \"hiker://images/icon_app3\";\n                    url = $(\"\").lazyRule((path, category, size) => {\n                        return $.require(\"hanshu\").lazy1(path, category, size);\n                    }, path, category, size);\n                } else {\n                    img = \"hiker://images/icon_unknown\";\n                    url = $(\"\").lazyRule((path, category, size) => {\n                        return $.require(\"hanshu\").lazy1(path, category, size);\n                    }, path, category, size);\n                }\n            }\n            d.push({\n                title: server_filename,\n                desc: desc,\n                img: img,\n                url: url,\n                col_type: \"icon_1_left_pic\",\n                extra: {\n                    inheritTitle: false,\n                    lineVisible: false,\n                    longClick: longclick,\n                    id: path\n                }\n            });\n        });\n    } else {\n        d.push({\n            title: \"登录过期\",\n            desc: \"BDUSS\",\n            url: \"hiker://empty\",\n            col_type: \"text_center_1\",\n            extra: {\n                lineVisible: false\n            }\n        });\n    }\n    setResult(d);\n}\n\nfunction jiexi1(path, category, size) {\n    if (category === 1) {\n        let header = Object.assign({}, header1, {\"User-Agent\": ua2});\n        let bdyp_play_mode1 = getItem(\"bdyp_play_mode1\", \"TV原画\");\n        let bdyp_play_mode2 = getItem(\"bdyp_play_mode2\");\n        if (bdyp_play_mode1 === \"TV原画\" || bdyp_play_mode2 === \"TV原画(转存)\") {\n            let html1 = get1(host1+\"/api/mediainfo?type=M3U8_FLV_264_480&path=\" + encodeURIComponent(path) + \"&clienttype=80&origin=dlna\", header); //log(html1)\n            if (html1.info) {\n                let dlink = html1.info.dlink; //log(dlink)\n                let html2 = JSON.parse(fetch(dlink,{\n                    headers: {\n                        \"User-Agent\": ua2,\n                        \"Range\": \"bytes=0-1\",\n                        \"Cookie\": \"#noCookie#\"\n                    },\n                    method: \"GET\",\n                    redirect: false,\n                    onlyHeaders: true\n                })); //log(html2)\n                if (html2.statusCode === 302) {\n                    let url = html2.headers.location[0]; log(url)\n                    return {url: url, header: header};\n                }\n            }\n        } else if (bdyp_play_mode1 === \"TV转码\" || bdyp_play_mode2 === \"TV转码(转存)\") {\n            let adToken = get1(host1+\"/api/streaming?type=\"+\"M3U8_AUTO_1080\"+\"&path=\"+encodeURIComponent(path)+\"&clienttype=80\").adToken; //log(adToken)\n            if (adToken) {\n                let type = [\"M3U8_AUTO_4K\", \"M3U8_AUTO_1080\", \"M3U8_AUTO_720\", \"M3U8_AUTO_480\"];\n                for (let i=0; i<4; i++) {\n                    let url = host1+\"/api/streaming?type=\"+type[i]+\"&path=\"+encodeURIComponent(path)+\"&clienttype=80\"+\"&adToken=\"+encodeURIComponent(adToken); log(url)\n                    let html1 = fetch(url, {\n                        headers: header,\n                        method: \"GET\",\n                    });\n                    if (html1.includes(\"#EXTM3U\")) {\n                        writeFile(\"hiker://files/_cache/video.m3u8\", html1);\n                        //return {url: url, header: header};\n                        return {url: getPath(\"hiker://files/_cache/video.m3u8\"), header: header};\n                    }\n                }\n            }\n        }\n    } else {\n        let header = Object.assign({}, header1, {\"User-Agent\": ua3});\n        let html1 = get1(\"https://d.pcs.baidu.com/rest/2.0/pcs/file?app_id=250528&method=locatedownload&path=\"+encodeURIComponent(path)+\"&use=1\", header); //log(html1) \n        let url = html1.urls[0].url; log(url)\n        if (size < 52428800) {\n            return {url: url, header: header1};\n        } else {\n            return {url: url, header: header};\n        }\n    }\n}\n\nfunction lazy1(path, category, size) {\n    let data = jiexi1(path, category, size);\n    if (category === 1) {\n        if (data.url.includes(\"video.m3u8\")) {\n            let url = startProxyServer($.toString(() => {\n                return {\n                    body: readFile(\"hiker://files/download/video.m3u8\"),\n                    headers: {\n                        'Content-Type': 'application/x-mpegURL'\n                    },\n                    statusCode: 200\n                };\n            }))\n            url = url + '?u=' + base64Encode(data.url) + \"#isVideo=true##fastPlayMode##threads=10#\"\n            return JSON.stringify({\n                urls: [url]\n            });\n        } else {\n            return JSON.stringify({\n                urls: [data.url+\"#isVideo=true##fastPlayMode##threads=10#\"],\n                headers: [data.header]\n            });\n        }\n    } else {\n        if (size < 52428800) {\n            return \"download://\" + data.url;\n        } else if (size < 314572800) {\n            return preview_download(data.url);\n        } else {\n            toast(\"不支持下载\");\n            return \"hiker://empty\";\n        }\n    }\n}\n\nfunction gethtml(path1) {\n    let url = host1+\"/s/\"+path1;\n    let html1 = JSON.parse(fetch(url, {\n        headers: {\n            \"User-Agent\": ua1,\n            \"Cookie\": \"#noCookie#\"\n        },\n        method: \"HEAD\",\n        redirect: false,\n        onlyHeaders: true\n    })); //log(html1)\n    if (html1.statusCode === 302) {\n        let url1 = html1.headers.location[0]; //log(url1)\n        let html2 = JSON.parse(fetch(host1+url1.replace(\"/share/init\", \"/share/verify\"), {\n            headers: {\n                \"User-Agent\": ua1,\n                \"Referer\": host1+url1,\n                \"Cookie\": \"#noCookie#\"\n            },\n            body: \"pwd=\"+url.match(/pwd=(\\w+)/)[1]+\"&vcode=&vcode_str=\",\n            method: \"POST\"\n        })); //log(html2)\n        let BDCLND = html2.randsk;\n        url1 = url1.match(/surl=(.{22})&pwd=(\\w+)/);\n        if (url1) return {surl: url1[1], pwd: url1[2], BDCLND: BDCLND};\n    } else {\n        return {surl: path1.match(/(.{23})/)[1], pwd: path1.match(/pwd=(\\w+)/)[1]};\n    }\n}\n\nfunction search1(data) {\n    log(data)\n    let d = [];\n    let page = MY_PAGE;\n    let bdyp_paixu = getItem(\"bdyp_paixu\", \"↓按修改时间\");\n    if (page === 1) {\n        let d1 = [];\n        d1.push({\n            title: \"界面设置\",\n            img: \"hiker://images/icon_menu6\",\n            url: \"select://\"+JSON.stringify({\n                \"title\": \"盘外\",\n                \"options\": [\"视频\"],\n                col: 1,\n                js: $.toString(()=>{\n                    return $.require(\"hanshu\").setting1(input, \"盘外\");\n                })\n            }),\n            col_type: \"icon_2_round\"\n        });\n        d1.push({\n            title: \"账号设置\",\n            img: \"hiker://images/icon_setting6\",\n            url: $([\"网页登录\", \"扫码登录\", \"Cookie登录\", \"复制Cookie\", \"清除Cookie\"]).select(() => {\n                return $.require(\"account\").account_setting(input);\n            }),\n            col_type: \"icon_2_round\"\n        });\n        d1.push({\n            title: host1+\"/s/1\"+data.surl+\"?pwd=\"+data.pwd,\n            desc: \"点我复制分享链接\",\n            url: \"copy://\"+host1+\"/s/1\"+data.surl+\"?pwd=\"+data.pwd,\n            col_type: \"text_center_1\",\n            extra: {\n                lineVisible: false\n            }\n        });\n        d1.push({\n            title: \"♥收藏\",\n            url: \"hiker://collection?rule=\"+MY_RULE.title,\n            col_type: \"scroll_button\"\n        }, {\n            title: \"✿历史\",\n            url: \"hiker://history?rule=\"+MY_RULE.title,\n            col_type: \"scroll_button\"\n        }, {\n            title: bdyp_paixu,\n            url: $(\"#noLoading#\").lazyRule(() => {\n                if (getItem(\"bdyp_paixu\", \"↓按修改时间\") === \"↓按修改时间\") {\n                    setItem(\"bdyp_paixu\", \"↑按修改时间\");\n                } else {\n                    setItem(\"bdyp_paixu\", \"↓按修改时间\");\n                }\n                refreshPage();\n                toast(\"设置成功\");\n                return \"hiker://empty\";\n            }),\n            col_type: \"scroll_button\"\n        });\n        setPreResult(d1);\n    }\n    let header = Object.assign({}, header1, {\"Cookie\": \"BDCLND=\"+data.BDCLND});\n    let html1;\n    if (!data.dir) {\n        html1 = get1(host1+\"/share/list?web=5&app_id=250528&desc=\"+(bdyp_paixu === \"↓按修改时间\" ? \"1\" : \"0\")+\"&showempty=0&page=1&num=20&order=time&shorturl=\"+data.surl+\"&root=1&view_mode=1&channel=chunlei&web=1&clienttype=0\", header); //log(html1)\n        setPageTitle(html1.title || \"\");\n    } else {\n        let dir;\n        if (data.dir.startsWith(\"/我的资源/\")) {\n            dir = data.dir.replace(\"我的资源\", \"sharelink\"+data.uk+\"-\"+data.fs_id);\n        } else {\n            dir = data.dir;\n        }\n        html1 = get1(host1+\"/share/list?is_from_web=true&uk=\"+data.uk+\"&shareid=\"+data.shareid+\"&order=name&desc=\"+(bdyp_paixu === \"↓按修改时间\" ? \"1\" : \"0\")+\"&showempty=0&view_mode=1&web=1&page=1&num=100&dir=\"+encodeURIComponent(dir)+\"&channel=chunlei&web=1&app_id=250528&clienttype=0\", header); //log(html1)\n    }\n    if (html1.errno === 0) {\n        let uk = html1.uk.toString();\n        let share_id = html1.share_id.toString();\n        html1.list.forEach(it => {\n            const {isdir, category, server_filename, server_mtime, size, path, fs_id} = it;\n            const datas = Object.assign({}, data, {uk: uk, shareid: share_id, fs_id: fs_id, dir: path, category: category, size: size});\n            const longclick = [{\n                title: \"转存\",\n                js: $.toString((data) => {\n                    if ($.require(\"hanshu\").zhuancun(data) !== undefined) toast(\"转存成功\"); return \"hiker://empty\";\n                }, datas)\n            }];\n            let desc, img, url;\n            if (isdir == 1) {\n                desc = \"文件夹\"+\"  \"+formatTimestamp(server_mtime);\n                img = \"hiker://images/icon_folder3\";\n                url = $(\"hiker://empty\").rule((data) => {\n                    $.require(\"hanshu\").search1(data);\n                }, datas);\n            } else {\n                longclick.push({\n                    title: \"下载\",\n                    js: $.toString((datas) => {\n                        \n                        if (datas.category === 1 || datas.size < 52428800) {\n                            let data = $.require(\"hanshu\").jiexi2(datas);\n                            let playHeader = Object.keys(data.header).map(key => key + \"@\" + String(data.header[key]).replace(/;/g, \"；；\"));\n                            return \"download://\" + data.url + \";{\" + playHeader.join(\"&&\") + \"}\";\n                        } else if (datas.size < 314572800) {\n                            let {jiexi2, preview_download} = $.require(\"hanshu\");\n                            let data = jiexi2(datas);\n                            return preview_download(data.url);\n                        } else {\n                            toast(\"不支持下载\");\n                            return \"hiker://empty\";\n                        }\n                        \n                    }, datas)\n                });\n                desc = bytesToSize(size)+\"  \"+formatTimestamp(server_mtime);\n                if (category === 1) {\n                    img = it.thumbs.url3;\n                    url = $(\"\").lazyRule((data) => {\n                        return $.require(\"hanshu\").lazy2(data);\n                    }, datas);\n                } else if (category === 2) {\n                    img = \"hiker://images/icon_music3\";\n                    url = $(\"\").lazyRule((data) => {\n                        //return $.require(\"hanshu\").lazy2(data);\n                    }, datas);\n                } else if (category === 3) {\n                    img = it.thumbs.url3;\n                    url = it.thumbs.url3+\"#.png\";\n                } else if (category === 4) {\n                    img = \"hiker://images/icon_txt2\";\n                    url = $(\"\").lazyRule((data) => {\n                        return $.require(\"hanshu\").lazy2(data);\n                    }, datas);\n                } else if (category === 5) {\n                    img = \"hiker://images/icon_app3\";\n                    url = $(\"\").lazyRule((data) => {\n                        return $.require(\"hanshu\").lazy2(data);\n                    }, datas);\n                } else {\n                    img = \"hiker://images/icon_unknown\";\n                    url = $(\"\").lazyRule((data) => {\n                        return $.require(\"hanshu\").lazy2(data);\n                    }, datas);\n                }\n            }\n            d.push({\n                title: server_filename,\n                desc: desc,\n                img: img,\n                url: url,\n                col_type: \"icon_1_left_pic\",\n                extra: {\n                    inheritTitle: false,\n                    lineVisible: false,\n                    longClick: longclick,\n                    id: path\n                }\n            });\n        });\n    } else {\n        d.push({\n            title: html1.show_msg,\n            desc: \"点我访问分享链接\",\n            url: host1+\"/s/1\"+data.surl+\"?pwd=\"+data.pwd,\n            col_type: \"text_center_1\",\n            extra: {\n                lineVisible: false\n            }\n        });\n    }\n    setResult(d);\n}\n\nfunction jiexi2(data) {\n    let category = data.category;\n    let bdyp_play_mode2 = getItem(\"bdyp_play_mode2\", \"APP原画(不转存)\");\n    if (bdyp_play_mode2 === \"APP原画(不转存)\") {\n        if (category === 1) {\n            eval(getCryptoJS());\n            function sha1(message) {\n                let hash = CryptoJS.SHA1(message);\n                return hash.toString(CryptoJS.enc.Hex);\n            }\n            let header = Object.assign({}, header1, {\"User-Agent\": ua3});\n            let devuid = \"73CED981D0F186D12BC18CAE1684FFD5|VSRCQTF6W\";\n            let time = String(new Date().getTime());\n            let rand = sha1(sha1(getItem(\"cookie\").match(/BDUSS=(.+?);/)[1])+\"3528972618ebrcUYiuxaZv2XGu7KIYKxUrqfnOfpDF\"+time+devuid+\"11.30.2ae5821440fab5e1a61a025f014bd8972\");\n            let url1 = host1+\"/share/list?shareid=\"+data.shareid+\"&uk=\"+data.uk+\"&fid=\"+data.fs_id+\"&sekey=\"+data.BDCLND+\"&origin=dlna&devuid=\"+devuid+\"&clienttype=1&channel=android_12_zhao_bd-netdisk_1024266h&version=11.30.2&time=\"+time+\"&rand=\"+rand; \n            let html1 = JSON.parse(fetch(url1, {\n                headers: header,\n                method: \"GET\"\n            })); //log(html1)\n            if (html1.errno === 0) {\n                let url2 = html1.list[0].dlink;\n                let html2 = JSON.parse(fetch(url2, {\n                    headers: header,\n                    method: \"GET\",\n                    redirect: false,\n                    onlyHeaders: true\n                })); //log(html2)\n                if (html2.statusCode === 302) {\n                    let url = html2.headers.location[0];\n                    return {url: url, header: header};\n                }\n            }\n        } else {\n            eval(getCryptoJS());\n            function sha1(message) {\n                let hash = CryptoJS.SHA1(message);\n                return hash.toString(CryptoJS.enc.Hex);\n            }\n            let header = Object.assign({}, header1, {\"User-Agent\": ua3});\n            let devuid = \"73CED981D0F186D12BC18CAE1684FFD5|VSRCQTF6W\";\n            let time = String(new Date().getTime());\n            let rand = sha1(sha1(getItem(\"cookie\").match(/BDUSS=(.+?);/)[1])+\"3528972618ebrcUYiuxaZv2XGu7KIYKxUrqfnOfpDF\"+time+devuid+\"11.30.2ae5821440fab5e1a61a025f014bd8972\");\n            let url1 = host1+\"/share/list?shareid=\"+data.shareid+\"&uk=\"+data.uk+\"&fid=\"+data.fs_id+\"&sekey=\"+data.BDCLND+\"&devuid=\"+devuid+\"&clienttype=1&channel=android_12_zhao_bd-netdisk_1024266h&version=11.30.2&time=\"+time+\"&rand=\"+rand; \n            let html1 = JSON.parse(fetch(url1, {\n                headers: header,\n                method: \"GET\"\n            })); //log(html1)\n            if (html1.errno === 0) {\n                let url2 = html1.list[0].dlink.match(/\\/file\\/(\\w+)\\?(.+)/); //log(url2)\n                url2 = \"https://d.pcs.baidu.com/rest/2.0/pcs/file?app_id=250528&method=locatedownload&path=\"+url2[1]+\"&\"+url2[2]+\"&use=1\"; //log(url2)\n                let html2 = JSON.parse(fetch(url2, {\n                    headers: header,\n                    method: \"GET\",\n                })); //log(html2)\n                let url = html2.urls[0].url;\n                if (data.size < 52428800) {\n                    return {url: url, header: header1};\n                } else {\n                    return {url: url, header: header};\n                }\n            }\n        }\n    } else if (bdyp_play_mode2 === \"网页转码(不转存)\") {\n        if (category === 1) {\n        let url1 = host1+\"/share/tplconfig?surl=\"+\"1\"+data.surl+\"&fields=sign,timestamp\";\n        let html1 = JSON.parse(fetch(url1, {\n            headers: {\n                \"Cookie\": \"#noCookie#\"\n            },\n            method: \"GET\"\n        })); //log(html1)\n        if (html1.errno === 0) {\n            let type = [\"M3U8_AUTO_4K\", \"M3U8_AUTO_1080\", \"M3U8_AUTO_720\", \"M3U8_AUTO_480\"];\n            for (let i=0; i<4; i++) {\n                let url = host1+\"/share/streaming?uk=\"+data.uk+\"&fid=\"+data.fs_id+\"&sign=\"+html1.data.sign+\"&timestamp=\"+html1.data.timestamp+\"&shareid=\"+data.shareid+\"&type=\"+type[i]+\"&jsToken\"; //log(url)\n                let html2 = fetch(url, {\n                    headers: header1,\n                    method: \"GET\",\n                }); //log(html2)\n                if (html2.includes(\"#EXTM3U\")) {\n                    writeFile(\"hiker://files/_cache/video.m3u8\", html2);\n                    return {url: getPath(\"hiker://files/_cache/video.m3u8\"), header: header1};\n                }\n            }\n        }\n        }\n    } else if (bdyp_play_mode2 === \"TV原画(转存)\") {\n        let list = $.require(\"hanshu\").zhuancun(data);\n        if (list) {\n            let url = jiexi1(list.to, data.category, data.size);\n            shanchu(list.to);\n            return url;\n        }\n    } else if (bdyp_play_mode2 === \"TV转码(转存)\") {\n        let list = $.require(\"hanshu\").zhuancun(data);\n        if (list) {\n            let url = jiexi1(list.to, data.category, data.size);\n            shanchu(list.to);\n            return url;\n        }\n    }\n}\n\nfunction lazy2(datas) {\n    let data = jiexi2(datas);\n    if (datas.category === 1) {\n        if (data.url.includes(\"video.m3u8\")) {\n            let url = startProxyServer($.toString(() => {\n                return {\n                    body: readFile(\"hiker://files/download/video.m3u8\"),\n                    headers: {\n                        'Content-Type': 'application/x-mpegURL'\n                    },\n                    statusCode: 200\n                };\n            }))\n            url = url + '?u=' + base64Encode(data.url) + \"#isVideo=true##fastPlayMode##threads=10#\"\n            return JSON.stringify({\n                urls: [url]\n            });\n        } else {\n            return JSON.stringify({\n                urls: [data.url+\"#isVideo=true##fastPlayMode##threads=10#\"],\n                headers: [data.header]\n            });\n        }\n    } else {\n        if (datas.size < 52428800) {\n            return \"download://\" + data.url;\n        } else if (datas.size < 314572800) {\n            return preview_download(data.url);\n        } else {\n            toast(\"不支持下载\");\n            return \"hiker://empty\";\n        }\n    }\n}\n\n// 取文件名后缀\nfunction getHzm(fileName) {\n    return fileName.substr(fileName.lastIndexOf(\".\") + 1).toLowerCase();\n}\n\n// by LoyDgIk 佬\nfunction bytesToSize(size) {\n    if (!size) {\n        return \"0\";\n    }\n    const units = [\"B\", \"KB\", \"MB\", \"GB\", \"TB\", \"PB\", \"EB\", \"ZB\", \"YB\"];\n    let i = 0;\n    while (size >= 1024) {\n        size /= 1024;\n        i++;\n    }\n    size = i ? Number(size.toFixed(2)) : size;\n    return `${size} ${units[i]}`;\n}\n\nfunction formatTimestamp(timestamp) {\n    // 确保时间戳是数字类型并转换\n    let ts = +timestamp; // 使用一元加号，确保转换为数字\n    // 如果时间戳是秒级（10位），转换为毫秒级（13位）\n    ts = ts < 1e12 ? ts * 1000 : ts;\n    // 创建日期对象\n    let date = new Date(ts);\n    // 格式化：通过小函数来补零，避免重复代码\n    let pad = (num) => num.toString().padStart(2, '0');\n    // 返回完整日期格式，精确到时分\n    return `${date.getFullYear()}-${pad(date.getMonth() + 1)}-${pad(date.getDate())} ${pad(date.getHours())}:${pad(date.getMinutes())}`;\n}\n\nfunction preview_download(url) {\n    toast(\"开始下载\");\n    let BaiduMultiThreadedDownloader = GM.defineModule(\"BaiduMultiThreadedDownloader\");\n    return BaiduMultiThreadedDownloader.downloadFile(url, getPath(\"hiker://files/download/\").replace(\"file://\", \"\"), null, {\n        headers: {\n            \"User-Agent\": ua3,\n            \"Range\": \"0-1\"\n        },\n        threadCount: 6,\n        //chunkSize: 140068\n    }) ? toast(\"下载完成\") : toast(\"请等待下载结束\");\n}\n\n// 文件转存函数\nfunction zhuancun(data) {\n    let html1 = JSON.parse(fetch(host1+\"/share/transfer\", {\n        headers: {\n            \"User-Agent\": \"Android\",\n            \"Referer\": host1,\n            \"Cookie\": \"BDCLND=\"+data.BDCLND+\"; \"+cookie1\n        },\n        body: \"from=\"+data.uk+\"&shareid=\"+data.shareid+\"&ondup=newcopy&path=\"+encodeURIComponent(\"/\")+\"&fsidlist=\"+encodeURIComponent(\"[\"+data.fs_id+\"]\"),\n        method: \"POST\",\n        rejectCoding: true\n    })); //log(html1)\n    if (html1.errno === 0) {\n        return html1.extra.list[0];\n    } else {\n        return toast(html1.show_msg);\n    }\n}\n\n// 文件删除函数\nfunction shanchu(path) {\n    let html1 = JSON.parse(fetch(host1+\"/api/filemanager?opera=delete&clienttype=1\", {\n        headers: {\n            \"User-Agent\": \"Android\",\n            \"Cookie\": cookie1,\n        },\n        body: 'filelist='+encodeURIComponent('[\"'+path+'\"]'),\n        method: \"POST\",\n        rejectCoding: true\n    })); //log(html1)\n    if (html1.errno === 0) {\n        toast(\"已删除\");\n    } else {\n        toast(\"删除失败\");\n    }\n}\n\n// 文件重命名函数\nfunction rename(path, server_filename) {\n    return $(server_filename, server_filename).input((path) => {\n        let html1 = JSON.parse(fetch(\"https://pan.baidu.com/api/filemanager?opera=rename&clienttype=1\", {\n            headers: {\n                \"User-Agent\": \"Android\",\n                \"Cookie\": getItem(\"cookie\"),\n            },\n            body: \"filelist=\"+encodeURIComponent(`[{\"path\":\"${path}\",\"newname\":\"${input}\"}]`)+\"&async=2&ondup=fail\",\n            method: 'POST',\n            rejectCoding: true\n        })); //log(html1)\n        if (html1.errno === 0) {\n            toast(\"重命名成功\");\n        } else {\n            toast(\"重命名失败\");\n        }\n    }, path)\n}\n\n$.exports = {\n    shouye,\n    jiexi1,\n    lazy1,\n    gethtml,\n    search1,\n    jiexi2,\n    lazy2,\n    preview_download,\n    zhuancun,\n    shanchu,\n    rename,\n    setting1\n}"},{"col_type":"movie_3","name":"账号","path":"account","rule":"$.exports.account_setting = function(input) {\n    if (input === \"网页登录\") {\n        return $(\"hiker://empty#noRecordHistory##noHistory#\").rule(() => {\n            let d = [];\n            setPageTitle(\"登录账号\");\n            d.push({\n                title: \"““确认登录””\",\n                desc: \"““””<small>点击头像可以退出账号重新登录</small>\",\n                url: $(\"#noLoading#\").lazyRule(() => {\n                    let cookie = getMyVar(\"cookie\", \"\"); //log(cookie)\n                    if (cookie.includes(\"BDUSS=\") && cookie.includes(\"PTOKEN=\")) {\n                        let BDUSS = cookie.match(/BDUSS=.+?;/)[0];\n                        log(BDUSS)\n                        let PTOKEN = cookie.match(/PTOKEN=.+?;/)[0];\n                        log(PTOKEN)\n                        let header1 = {\n                            \"User-Agent\": \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36\",\n                            \"Cookie\": BDUSS\n                        };\n\n                        function get1(url1, header1) {\n                            let html1 = JSON.parse(fetch(url1, {\n                                headers: header1,\n                                method: \"GET\",\n                                redirect: false,\n                                onlyHeaders: true\n                            })); //log(html1)\n                            return html1;\n                        }\n                        let html1 = get1(\"https://pan.baidu.com/disk/home\", header1); //log(html1)\n                        if (html1.statusCode === 302) {\n                            let url1 = html1.headers.location[0];\n                            let html2 = get1(url1, Object.assign({}, header1, {\n                                \"Cookie\": PTOKEN + BDUSS\n                            })); //log(html2)\n                            if (html2.statusCode === 302) {\n                                let url2 = html2.headers.location[0];\n                                let html3 = get1(url2, header1); //log(html3)\n                                if (html3.statusCode === 302) {\n                                    let set_cookie3 = html3.headers[\"set-cookie\"].join(\"  \"); //log(set_cookie3)\n                                    if (set_cookie3.includes(\"STOKEN=\")) {\n                                        let STOKEN = set_cookie3.match(/STOKEN=.+?;/)[0];\n                                        log(STOKEN)\n                                        setItem(\"cookie\", BDUSS + STOKEN);\n                                        toast(\"登录成功\");\n                                        back(true);\n                                        return \"hiker://empty\";\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    toast(\"登录失败\");\n                    return \"hiker://empty\";\n                }),\n                col_type: \"text_center_1\"\n            });\n            d.push({\n                col_type: \"line_blank\"\n            });\n            let durl = \"https://passport.baidu.com/\";\n            d.push({\n                desc: \"list&&screen-150\",\n                url: durl,\n                col_type: \"x5_webview_single\",\n                extra: {\n                    ua: PC_UA,\n                    js: $.toString((title, durl) => {\n                        let cookie = \"\";\n                        setInterval(() => {\n                            cookie = fba.getCookie(durl);\n                            if (cookie.includes(\"BDUSS=\") && cookie.includes(\"PTOKEN=\")) {\n                                fba.putVar(title + \"@cookie\", cookie);\n                            }\n                        }, 200);\n                    }, MY_RULE.title, durl)\n                }\n            });\n            setResult(d);\n        });\n    } else if (input === \"Cookie登录\") {\n        return $(\"\", \"填写获取到的Cookie\").input(() => {\n            if (input.includes(\"BDUSS=\") && input.includes(\"STOKEN=\")) {\n                setItem(\"cookie\", input);\n                toast(\"登录成功\");\n                refreshPage();\n            } else {\n                return toast(\"cookie错误\");\n            }\n        });\n    } else if (input === \"复制Cookie\") {\n        copy(getItem(\"cookie\"));\n        return toast(\"复制成功\");\n    } else if (input === \"清除Cookie\") {\n        clearItem(\"cookie\");\n        toast(\"清除成功\");\n        refreshPage();\n    } else if (input === \"扫码登录\") {\n        // 道长群嗷呜大佬提供\n        return $(\"hiker://empty#noRecordHistory##noHistory#\").rule(() => {\n            try {\n                function generateRandomUUID() {\n                    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n                        var r = Math.random() * 16 | 0,\n                            v = c === 'x' ? r : (r & 0x3 | 0x8);\n                        return v.toString(16);\n                    });\n                }\n                function getjson(data) {\n                    let start_idx = data.indexOf('(') + 1;\n                    let end_idx = data.lastIndexOf(')');\n                    if (start_idx > 0 && end_idx > 0) {\n                        let json_str = data.substring(start_idx, end_idx);\n                        json_str = json_str.replaceAll('&quot;', '\"').replaceAll(\"'\", '\"')\n                        let json_obj = JSON.parse(json_str)\n                        return json_obj\n                    }\n                }\n                let ljurl = 'https://passport.baidu.com/v2/api/getqrcode'\n                let usurl = 'https://passport.baidu.com/channel/unicast'\n                let sturl = 'https://passport.baidu.com/v3/login/main/qrbdusslogin'\n                let sturl1 = 'https://passport.baidu.com/v3/login/api/auth/?return_type=5&tpl=netdisk&u=https://pan.baidu.com/disk/home'\n                let request_id = generateRandomUUID();\n                let t3 = new Date().getTime().toString()\n                let t1 = Math.floor(new Date().getTime() / 1000).toString()\n                let headers = {\n                    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; ) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.61 Chrome/126.0.6478.61 Not/A)Brand/8  Safari/537.36',\n                    'sec-ch-ua-platform': '\"Windows\"',\n                    'sec-ch-ua': '\"Not/A)Brand\";v=\"8\", \"Chromium\";v=\"126\", \"Google Chrome\";v=\"126\"',\n                    'DNT': '1',\n                    'sec-ch-ua-mobile': '?0',\n                    'Sec-Fetch-Site': 'same-site',\n                    'Sec-Fetch-Mode': 'no-cors',\n                    'Sec-Fetch-Dest': 'script',\n                    'Referer': 'https://pan.baidu.com/',\n                    'Accept-Language': 'zh-CN,zh;q=0.9',\n                }\n                // 获取二维码链接\n                let guidt = t3\n                let ljparams = {\n                    'lp': 'pc',\n                    'qrloginfrom': 'pc',\n                    'gid': request_id,\n                    'callback': `tangram_guid_${t3}`,\n                    'apiver': 'v3',\n                    'tt': t3,\n                    'tpl': 'netdisk',\n                    'logPage': `traceId:pc_loginv5_${t1},logPage:loginv5`,\n                    '_': t3\n                }\n                let qrdata = getjson(fetch(buildUrl(ljurl, ljparams), {\n                    headers: headers\n                }))\n                let qrurl = qrdata.imgurl\n                let channel_id = qrdata.sign\n                let q = []\n                q.push({\n                    url: $(`https://${qrurl}#.jpg`, headers).image(),\n                    col_type: \"pic_1_full\",\n                    pic_url: $(`https://${qrurl}`, headers).image(),\n                });\n                setResult(q);\n                // createQRCode(`https://${qrurl}`, false);\n                // 获取bduss\n                let bduss = \"\";\n                for (let i = 0, ec = 0; i < 30; i++) {\n                    java.lang.Thread.sleep(2000);\n                    try {\n                        let usparams = {\n                            'channel_id': channel_id,\n                            'gid': request_id,\n                            'tpl': 'netdisk',\n                            '_sdkFrom': '1',\n                            'callback': `tangram_guid_${guidt}`,\n                            'apiver': 'v3',\n                            'tt': t3,\n                            '_': t3,\n                        }\n                        let usdata = getjson(fetch(buildUrl(usurl, usparams), {\n                            headers: headers\n                        }))\n                        if (usdata.channel_v) {\n                            let bddata = JSON.parse(usdata.channel_v);\n                            if (bddata.v) {\n                                bduss = bddata.v\n                                break;\n                            }\n                            continue\n                        }\n                    } catch (e) {\n                        ec++;\n                        if (ec >= 5) {\n                            return \"toast://查询二维码出错\";\n                        }\n                    }\n                }\n                let stparams = {\n                    'v': t3,\n                    'bduss': bduss,\n                    'u': 'https://pan.baidu.com/disk/main%23/index?category%3Dall',\n                    'loginVersion': 'v5',\n                    'qrcode': '1',\n                    'tpl': 'netdisk',\n                    'maskId': '',\n                    'fileId': '',\n                    'apiver': 'v3',\n                    'tt': t3,\n                    'traceid': '',\n                    'time': t1,\n                    'alg': 'v3',\n                    'elapsed': '1',\n                    'callback': 'bd__cbs__tro4ll'\n                }\n                // 获取cookie\n                let stdata = getjson(fetch(buildUrl(sturl, stparams), {\n                    headers: headers\n                }))\n                if (stdata.data && stdata.data.session) {\n                    let cdata = stdata.data.session;\n                    let bduss = cdata.bduss\n                    log('获取bduss:' + bduss)\n                    let stoken = cdata.stoken\n                    let ptoken = cdata.ptoken\n                    let ubi = encodeURIComponent(cdata.ubi)\n                    let cookies = {\n                        'newlogin': '1',\n                        'UBI': ubi,\n                        'STOKEN': stoken,\n                        'BDUSS': bduss,\n                        'PTOKEN': ptoken,\n                        'BDUSS_BFESS': bduss,\n                        'STOKEN_BFESS': stoken,\n                        'PTOKEN_BFESS': ptoken,\n                        'UBI_BFESS': ubi,\n                    }\n                    function buildk(params) {\n                        return Object.keys(params)\n                            .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)\n                            .join(';');\n                    }\n                    headers.Cookie = buildk(cookies)\n                    let data = fetch(sturl1, {\n                        headers: headers,\n                        onlyHeaders: true,\n                        redirect: false\n                    })\n                    let lur = JSON.parse(data).headers.location[0]\n                    let ldata = fetch(lur, {\n                        headers: headers,\n                        onlyHeaders: true,\n                        redirect: false\n                    })\n                    let ck = JSON.parse(ldata).headers['set-cookie']\n                    let stokenCookie = ck.find(c => c.toLowerCase().includes('stoken'))\n                    stokenCookie = stokenCookie.split(';')[0].split('=')[1]\n                    log('获取stoken:' + stokenCookie)\n                    setItem(\"cookie\", \"BDUSS=\" + cdata.bduss + \";\" + \"STOKEN=\" + stokenCookie + \";\");\n                    back(true);\n                }\n            } catch (e) {\n                toast(\"登录失败：\" + e.toString());\n                back(false);\n            }\n        });\n    }\n}"},{"col_type":"movie_3","name":"GA&GM","path":"GA&GM.js","rule":"//by LoyDgIk 佬\nconst JavaMap = java.util.HashMap;\nconst globalMapSymbol = Symbol(\"globalMap\");\nconst mapSymbol = Symbol(\"myJavaMap\");\nconst selfSymbol = Symbol(\"selfKey\");\n\nfunction getTypeName(obj) {\n    return Object.prototype.toString.call(obj);\n}\n\nconst protoDic = new Map([\n    [\"[object Array]\", Array],\n    [\"[object Date]\", Date],\n    [\"[object Object]\", Object],\n    [\"[object Promise]\", Promise],\n    [\"[object Map]\", Map],\n    [\"[object Symbol]\", Symbol],\n    [\"[object Array]\", Array],\n    [\"[object Function]\", Function],\n    [\"Error\", Error],\n    [\"TypeError\", TypeError],\n    [\"EvalError\", EvalError],\n    [\"SyntaxError\", SyntaxError],\n    [\"ReferenceError\", ReferenceError],\n    [\"RangeError\", RangeError]\n]);\n\nfunction dealWithVal(val) {\n    let typeName = getTypeName(val);\n    let errorName;\n    if (val instanceof java.lang.String) {\n        return String(val);\n    } else if (val instanceof java.lang.Double) {\n        return Number(val);\n    } else if (val instanceof java.lang.Boolean) {\n        if (String(val) === \"true\") {\n            val = true;\n        } else {\n            val = false;\n        }\n        return val;\n    } else if (typeName === \"[object Error]\" && protoDic.has((errorName = val.toString()))) {\n        val.__proto__ = val.__proto__ && Object.assign(Object.create(protoDic.get(typeName).prototype), val.__proto__);\n        return val;\n    } else if (typeName !== \"[object javaObject]\" && protoDic.has(typeName)) {\n        val.__proto__ = val.__proto__ && Object.assign(Object.create(protoDic.get(typeName).prototype), val.__proto__);\n        return val;\n    }\n    return val;\n}\n\nfunction isString(str) {\n    return typeof(str) === \"string\" || str instanceof java.lang.String;\n}\n\nfunction GlobalVar(javaMap, selfKey) {\n    this[globalMapSymbol] = javaMap;\n    this[selfSymbol] = selfKey;\n    this.raw = false;\n}\nObject.assign(GlobalVar.prototype, {\n    getHashMap(symbol) {\n        if (symbol !== mapSymbol) return null;\n        if (this[mapSymbol]) return this[mapSymbol];\n        let selfKey = this[selfSymbol];\n        if (!selfKey) {\n            throw Error(\"当前没有全局环境，请使用setSelfKey指定规则名\");\n        }\n        this[mapSymbol] = this[globalMapSymbol];\n        return this[mapSymbol];\n    },\n    setSelfKey(key) {\n        //if (!this[selfSymbol]) this[selfSymbol] = key;\n        this[selfSymbol] = key;\n    },\n    getSelfKey(){\n        return this[selfSymbol];\n    },\n    getMapKey(key) {\n        return String(this[selfSymbol] + key);\n    },\n    get(key, def) {\n        key = this.getMapKey(key);\n        let hashMap = this.getHashMap(mapSymbol);\n        if (!hashMap.containsKey(key)) return def;\n        let val = hashMap.get(key);\n        if (this.raw) {\n            return val;\n        } else {\n            return dealWithVal(val);\n        }\n    },\n    getRaw(key, def) {\n        key = this.getMapKey(key);\n        let hashMap = this.getHashMap(mapSymbol);\n        if (!hashMap.containsKey(key)) return def;\n        return hashMap.get(key);\n    },\n    useRaw(noUseRaw) {\n        this.raw = !noUseRaw;\n        return this;\n    },\n    put(key, val) {\n        if (val === void 0) return;\n        let hashMap = this.getHashMap(mapSymbol);\n        hashMap.put(this.getMapKey(key), val);\n        return val;\n    },\n    clearAll() {\n        let self = this[selfSymbol];\n        let hashMap = this.getHashMap(mapSymbol);\n        this.getHashMap(mapSymbol).forEach((key, value) => {\n            if (isString(key) && String(key).startsWith(self)) {\n                hashMap.remove(key);\n            }\n        });\n    },\n    clear(key, call) {\n        if (this.hasButNoCall(key)) {\n            let hashMap = this.getHashMap(mapSymbol);\n            if (typeof call === \"function\") {\n                call(this.get(key));\n            }\n            hashMap.remove(this.getMapKey(key));\n        }\n    },\n    has(key, call) {\n        let mapKey = this.getMapKey(key);\n        let hashMap = this.getHashMap(mapSymbol);\n        let res = !!hashMap.containsKey(mapKey);\n        if (res && typeof call === \"function\") {\n            call(this.get(key));\n        }\n        return res;\n    },\n    hasButNoCall(key) {\n        let mapKey = this.getMapKey(key);\n        let hashMap = this.getHashMap(mapSymbol);\n        return !!hashMap.containsKey(mapKey);\n    },\n    define(key, val) {\n        if (this.hasButNoCall(key)) {\n            return this.get(key);\n        }\n        return this.put(key, val);\n    },\n    defineLazy(key, lazy) {\n        if (this.hasButNoCall(key)) {\n            return this.get(key);\n        }\n        return this.put(key, lazy());\n    },\n    defineModule(key, path, isNew) {\n        if(path===undefined){\n            path=key;\n        }\n        if (isNew) return this.put(key, $.require(path, key));\n        return this.defineLazy(key, () => $.require(path, key));\n    },\n    listKeys() {\n        let entrySet = this.getHashMap(mapSymbol).entrySet();\n        let selfKey = this[selfSymbol];\n        let keys = [];\n\n        for (let entry of entrySet) {\n            let key = entry.getKey();\n            if (isString(key) && key.startsWith(selfKey)) {\n                keys.push(String(key).replace(selfKey, \"\"));\n            }\n        }\n        return keys;\n    },\n    toJSON() {\n        let object = {};\n        let hashMap = this.getHashMap(mapSymbol);\n        let selfKey = this[selfSymbol];\n        hashMap.forEach((key, value) => {\n            if (!isString(key)) {\n                return;\n            }\n            let keyString = String(key);\n            if (keyString.startsWith(selfKey)) {\n                object[keyString.replace(selfKey, \"\")] = hashMap.get(key);\n            }\n        });\n        return object;\n    }\n});\nGlobalVar.prototype[Symbol.iterator] = function() {\n    let hashMap = this.getHashMap(mapSymbol);\n    let selfKey = this[selfSymbol];\n    let iterator = hashMap.entrySet().iterator();\n    return (function*() {\n        while (iterator.hasNext()) {\n            let me = iterator.next();\n            let key = me.getKey();\n            if (!isString(key)) {\n                continue;\n            }\n            key = String(key);\n            if (key.startsWith(selfKey)) {\n                yield [key.replace(selfKey, \"\"), dealWithVal(me.getValue())];\n            }\n        }\n    })();\n}\n\nconst GlobalMap = _globalMap;\n//_globalMap = void 0;\nlet RuleGlobalMapKey = (typeof MY_RULE !== \"undefined\"&&MY_RULE) ? MY_RULE.title : \"\";\nlet AppGlobalMapKey = \"AppGlobalMap\";\nif (RuleGlobalMapKey === AppGlobalMapKey) {\n    let randomKey = \"\";\n    if (GlobalMap.containsKey(0)) {\n        randomKey = String(GlobalMap.get(0));\n    } else {\n        randomKey = String(Date.now());\n        GlobalMap.put(0, randomKey);\n    }\n    RuleGlobalMapKey = RuleGlobalMapKey + randomKey;\n}\n$.exports = {\n    GA: new GlobalVar(GlobalMap, AppGlobalMapKey),\n    GM: new GlobalVar(GlobalMap, RuleGlobalMapKey)\n}"},{"col_type":"movie_3","name":"百度下载器","path":"BaiduMultiThreadedDownloader","rule":"//by LoyDgIk 佬\nconst Files = java.nio.file.Files;\nconst Paths = java.nio.file.Paths;\nconst BufferedInputStream = java.io.BufferedInputStream\nconst BufferedOutputStream = java.io.BufferedOutputStream\nconst FileOutputStream = java.io.FileOutputStream;\n//const java.util.ArrayList;\n//const java.util.List;\nconst ExecutorService = java.util.concurrent.ExecutorService;\nconst Executors = java.util.concurrent.Executors;\nconst TimeUnit = java.util.concurrent.TimeUnit\nconst Runnable = java.lang.Runnable;\nconst AtomicBoolean = java.util.concurrent.atomic.AtomicBoolean;\nconst URL = java.net.URL;\nconst Long = java.lang.Long;\n\nconst OkGo = com.lzy.okgo.OkGo;\nconst HttpsUtils = com.lzy.okgo.https.HttpsUtils;\nconst Arrays = java.util.Arrays;\nconst Comparator = java.util.Comparator;\nconst BUFFER_SIZE = 4096;\nconst File = java.io.File;\nconst Thread = java.lang.Thread;\nconst RandomAccessFile = java.io.RandomAccessFile;\nconst OkHttpClient = Packages.okhttp3.OkHttpClient;\nconst FileInputStream=java.io.FileInputStream;\n/**\n * 使用多线程分块下载文件，支持自定义 Headers，并将分块先写入临时文件，再合并。\n *\n * @param url         文件下载地址\n * @param outputPath  文件最终保存路径\n * @param chunkSize   每个线程下载的分块大小（单位：字节）\n * @param threadCount 下载使用的线程数\n * @param retryCount  每个分块下载失败的最大重试次数\n * @param headers     需要添加到请求中的自定义请求头（可为 null 表示不需要）\n */\nfunction downloadFile(\n    url,\n    outputPath,\n    filename,\n    config\n) {\n    let {\n        chunkSize,\n        threadCount,\n        retryCount,\n        headers\n    } = config || {};\n    let head = headers || {};\n    chunkSize = chunkSize || 2 * 1024 * 1024;\n    threadCount = threadCount || 4;\n    retryCount = retryCount || 3;\n    headers = new java.util.concurrent.ConcurrentHashMap();\n    for (let k in head) {\n        headers.put(k, head[k]);\n    }\n    let executorService = Executors.newFixedThreadPool(threadCount);\n    \n    let futures = []\n    \n    let downloadFailed = new AtomicBoolean(false);\n\n    \n    let fileSize;\n    try {\n        let fileinfo = getFileInfo(url, head);\n        fileSize = fileinfo.size;\n        filename = filename || fileinfo.name || md5(url);\n        if (!fileSize || Number.isNaN(fileSize)) {\n            throw Error(\"文件大小获取失败\");\n        }\n    } catch (e) {\n        log(\"获取文件大小失败: \" + e.toString());\n        executorService.shutdownNow();\n        return;\n    }\n    if (fileSize <= 0) {\n        log(\"无法获取文件大小或文件大小为0，下载终止。\");\n        executorService.shutdownNow();\n        return;\n    }\n    outputPath = outputPath + \"/\" + filename;\n\n    let tempDir = new File(outputPath + \".tmp\");\n    if (!tempDir.exists()) {\n        tempDir.mkdir();\n    }\n\n    let chunkCount = Math.ceil(fileSize / chunkSize);\n    let offset = 0;\n    for (let i = 0; i < chunkCount; i++) {\n        // 起始位置\n        let start = offset;\n        // 结束位置（最后一个线程可能到 fileSize - 1 ）\n        let end = (i == chunkCount - 1) ? (fileSize - 1) : (offset + chunkSize - 1);\n        offset = end + 1;\n\n        \n        let tempFile = new File(tempDir, \"chunk_\" + start + \"_\" + end + \".tmp\");\n\n        \n        let finalStart = start;\n        let finalEnd = end;\n        let finalTempFile = tempFile;\n\n        let future = executorService.submit(new Runnable(() => {\n            let attempts = 0;\n            let success = false;\n\n            while (!downloadFailed.get() && attempts < retryCount && !success) {\n                try {\n                    downloadChunk(url, finalStart, finalEnd, finalTempFile, headers);\n                    success = true;\n                } catch (e) {\n                    attempts++;\n                    log(\"线程 \" + Thread.currentThread().getName() +\n                        \" 下载分块 [\" + finalStart + \" - \" + finalEnd + \"] 失败，重试 \" +\n                        attempts + \"/\" + retryCount + \"，原因：\" + e.toString());\n                    if (attempts >= retryCount) {\n                        // 标记整个下载过程失败\n                        downloadFailed.set(true);\n                        // 抛出异常，终止当前任务\n                        throw new Error(\"线程 \" + Thread.currentThread().getName() +\n                            \" 超出最大重试次数，下载失败。Error:\" + e.toString());\n                    }\n                }\n            }\n            return null;\n        }));\n        futures.push(future);\n    }\n\n    \n    try {\n        for (let f of futures) {\n            f.get(); // 如果有异常，会在这里抛出\n        }\n    } catch (e) {\n        log(\"执行下载任务时出现异常: \" + e.toString());\n        downloadFailed.set(true);\n    } finally {\n        // 关闭线程池\n        executorService.shutdownNow();\n    }\n\n    // 合并分块文件\n    if (!downloadFailed.get()) {\n        mergeChunks(tempDir, outputPath);\n        // 删除临时文件夹及其中的文件\n        deleteTempFiles(tempDir);\n        log(\"文件下载并合并完成，保存路径：\" + outputPath);\n    } else {\n        // 如果下载失败，清空临时目录\n        deleteTempFiles(tempDir);\n        log(\"下载失败，临时文件已删除。\");\n    }\n}\n\nfunction getFileInfo(url, headers) {\n    let head = JSON.parse(fetch(url, {\n        headers: Object.assign({}, headers),\n        onlyHeaders: true,\n        method: \"HEAD\"\n    })).headers;\n    Object.keys(head).forEach(v => {\n        head[v] = head[v][0];\n    });\n    let fileinfo = {\n        md5: head[\"content-md5\"],\n        size: Number(head[\"x-bs-file-size\"] || head[\"content-length\"]),\n        name: /filename=\"(.*?)\"/.test(head[\"content-disposition\"]) ? RegExp.$1 : \"\"\n    };\n    return fileinfo;\n}\n\nfunction mergeChunks(tempDir, outputPath) {\n    let outputFile = new File(outputPath);\n    let raf = null;\n    try {\n        let raf = new RandomAccessFile(outputFile, \"rw\");\n\n        let chunkFiles = tempDir.listFiles(new java.io.FilenameFilter((dir, name) => name.endsWith(\".tmp\")));\n        if (chunkFiles == null) {\n            throw new Error(\"无法获取临时文件夹中的分块文件。\");\n        }\n\n        Arrays.sort(chunkFiles, Comparator.comparingLong(file => {\n            let name = file.getName();\n            let start = Long.parseLong(name.split(\"_\")[1]);\n            return start;\n        }));\n\n\n        for (let chunkFile of chunkFiles) {\n            let fis, bis;\n            try {\n                let fis = new FileInputStream(chunkFile);\n                let bis = new BufferedInputStream(fis);\n\n                let buffer = java.lang.reflect.Array.newInstance(java.lang.Byte.TYPE, BUFFER_SIZE);\n                let len;\n                while ((len = bis.read(buffer)) != -1) {\n                    raf.write(buffer, 0, len);\n                }\n            } finally {\n                fis && fis.close();\n                bis && bis.close();\n            }\n        }\n    } catch (e) {\n        log(\"合并分块文件时出错：\" + e.toString());\n    } finally {\n        raf && raf.close();\n    }\n}\nconst downloadClient = new OkHttpClient.Builder()\n    .connectTimeout(30, TimeUnit.SECONDS)\n    .readTimeout(50, TimeUnit.SECONDS)\n    .writeTimeout(40, TimeUnit.SECONDS)\n    .sslSocketFactory(HttpsUtils.getSslSocketFactory().sSLSocketFactory, HttpsUtils.UnSafeTrustManager)\n    .hostnameVerifier(HttpsUtils.UnSafeHostnameVerifier)\n    .build();\n\nfunction downloadChunk(\n    url,\n    start,\n    end,\n    tempFile,\n    headers\n) {\n\n    let request = OkGo.get(url);\n    // 如果有自定义 Headers，则添加\n    if (headers != null) {\n        for (let entry of headers.entrySet()) {\n            request.headers(entry.getKey(), entry.getValue());\n        }\n    }\n    //log(Object.keys(request))\n    request.headers(\"Range\", \"bytes=\" + start + \"-\" + end);\n    request.client(downloadClient);\n    // 执行同步请求，获取响应\n    let response = request.execute();\n    if (response == null || ~~(response.code() / 100) != 2) {\n        log(~~(response.code() / 100))\n        throw new Error(\"服务器返回异常，HTTP code = \" +\n            (response == null ? \"null\" : response.code()));\n    }\n\n    // 将响应体写入临时文件\n    let is = null,\n        bis = null,\n        fos = null;\n    try {\n        is = response.body();\n        bis = new BufferedInputStream(is.byteStream());\n        fos = new FileOutputStream(tempFile);\n\n        let buffer = java.lang.reflect.Array.newInstance(java.lang.Byte.TYPE, BUFFER_SIZE);\n        let len;\n        while ((len = bis.read(buffer)) != -1) {\n            fos.write(buffer, 0, len);\n        }\n    } finally {\n        is && is.close();\n        bis && bis.close();\n        fos && fos.close();\n    }\n}\n\nfunction deleteTempFiles(tempDir) {\n    if (tempDir.exists() && tempDir.isDirectory()) {\n        for (let file of tempDir.listFiles() || []) {\n            file.delete();\n        }\n        tempDir.delete();\n    }\n}\nlet isDownload = false;\n$.exports.downloadFile = function(url,\n    outputPath,\n    filename,\n    config) {\n    if (isDownload) return false;\n    isDownload=true;\n    downloadFile(url,\n        outputPath,\n        filename,\n        config);\n    isDownload=false;\n    return true;\n}\n"}],"title":"百度云盘1","author":"","version":1,"type":"all","url":"hiker://empty##","col_type":"movie_3","class_name":"","class_url":"","area_name":"","area_url":"","sort_name":"","year_name":"","sort_url":"","year_url":"","find_rule":"js:\n$.require(\"hanshu\").shouye(\"/\");","searchFind":"","search_url":"","group":"④网盘","detail_col_type":"movie_1","detail_find_rule":"","sdetail_col_type":"movie_1","sdetail_find_rule":"","ua":"mobile","preRule":"/*<$>\n@include start\nhiker://page/GA&GM.js\n@include end\n<$>*/","pages":"[{\"col_type\":\"movie_3\",\"name\":\"函数\",\"path\":\"hanshu\",\"rule\":\"const ua1 = PC_UA;\\nconst ua2 = \\\"netdisk;1.4.2;android-android;\\\";\\nconst ua3 = \\\"netdisk;P2SP;2.2.91.136;android-android;\\\";\\nconst cookie1 = getItem(\\\"cookie\\\"); \\nconst header1 = {\\n    \\\"User-Agent\\\": ua1,\\n    \\\"Cookie\\\": cookie1\\n};\\nconst host1 = \\\"https://pan.baidu.com\\\";\\n\\nfunction get1(url, header) {\\n    let html1 = fetch(url, {\\n        headers: header,\\n        method: \\\"GET\\\"\\n    });\\n    return JSON.parse(html1);\\n}\\n\\nfunction setting1(input, type) {\\n    if (type === \\\"盘内\\\") {\\n        if (input === \\\"视频\\\") {\\n            return \\\"select://\\\"+JSON.stringify({\\n                \\\"title\\\": \\\"当前播放模式：\\\"+getItem(\\\"bdyp_play_mode1\\\", \\\"TV原画\\\"),\\n                \\\"options\\\": [\\\"TV原画\\\", \\\"TV转码\\\"],\\n                col: 1,\\n                js: $.toString(()=>{\\n                    setItem(\\\"bdyp_play_mode1\\\", input);\\n                    toast(\\\"设置成功\\\");\\n                    return \\\"hiker://empty\\\";\\n                })\\n            });\\n        }\\n    } else {\\n        if (input === \\\"视频\\\") {\\n            return \\\"select://\\\"+JSON.stringify({\\n                \\\"title\\\": \\\"当前播放模式：\\\"+getItem(\\\"bdyp_play_mode2\\\", \\\"APP原画(不转存)\\\"),\\n                \\\"options\\\": [\\\"APP原画(不转存)\\\", \\\"TV原画(转存)\\\", \\\"TV转码(转存)\\\", \\\"网页转码(不转存)\\\"],\\n                col: 1,\\n                js: $.toString(()=>{\\n                    setItem(\\\"bdyp_play_mode2\\\", input);\\n                    toast(\\\"设置成功\\\");\\n                    return \\\"hiker://empty\\\";\\n                })\\n            });\\n        }\\n    }\\n}\\n\\nfunction shouye(dir) {\\n    let d = [];\\n    let page = MY_PAGE;\\n    let bdyp_paixu = getItem(\\\"bdyp_paixu\\\", \\\"↓按修改时间\\\");\\n    if (page === 1) {\\n        let d1 = [];\\n        d1.push({\\n            title: \\\"界面设置\\\",\\n            img: \\\"hiker://images/icon_menu6\\\",\\n            url: \\\"select://\\\"+JSON.stringify({\\n                \\\"title\\\": \\\"盘内\\\",\\n                \\\"options\\\": [\\\"视频\\\"],\\n                col: 1,\\n                js: $.toString(()=>{\\n                    return $.require(\\\"hanshu\\\").setting1(input, \\\"盘内\\\");\\n                })\\n            }),\\n            col_type: \\\"icon_2_round\\\"\\n        });\\n        d1.push({\\n            title: \\\"账号设置\\\",\\n            img: \\\"hiker://images/icon_setting6\\\",\\n            url: $([\\\"网页登录\\\", \\\"扫码登录\\\", \\\"Cookie登录\\\", \\\"复制Cookie\\\", \\\"清除Cookie\\\"]).select(() => {\\n                return $.require(\\\"account\\\").account_setting(input);\\n            }),\\n            col_type: \\\"icon_2_round\\\"\\n        });\\n        d1.push({\\n            title: \\\"搜索\\\",\\n            desc: \\\"请输入分享链接\\\",\\n            url: $.toString(() => {\\n                function match_link(input) {\\n                    if (input.includes(\\\"baidu\\\")) {\\n                        let path1\\n                        if (input.includes(\\\"pwd=\\\")) {\\n                            if (input.includes(\\\"/s/\\\")) {\\n                                path1 = input.match(/([\\\\w_-]{23}).+pwd=(\\\\w+)/);\\n                            } else if (input.includes(\\\"surl=\\\")) {\\n                                path1 = input.match(/([\\\\w_-]{22}).+pwd=(\\\\w+)/);\\n                            }\\n                        } else if (input.includes(\\\"提取码\\\")) {\\n                            path1 = input.match(/([\\\\w_-]{23})提取码:(\\\\w+)/);\\n                        }\\n                        if (path1) return path1[1]+\\\"?pwd=\\\"+path1[2];\\n                    }\\n                }\\n                let path1 = match_link(input.replace(/\\\\s/g,\\\"\\\").replace(/[\\\\u00A0]/g,\\\"\\\"));\\n                if (path1) {\\n                    showLoading(\\\"加载中\\\");\\n                    let data = $.require(\\\"hanshu\\\").gethtml(path1);\\n                    hideLoading();\\n                    return $(\\\"hiker://empty#page=fypage#noHistory#\\\").rule((data) => {\\n                        $.require(\\\"hanshu\\\").search1(data);\\n                    }, data);\\n                }\\n            }),\\n            col_type: \\\"input\\\"\\n        });\\n        d1.push({\\n            title: \\\"♥收藏\\\",\\n            url: \\\"hiker://collection?rule=\\\"+MY_RULE.title,\\n            col_type: \\\"scroll_button\\\"\\n        }, {\\n            title: \\\"✿历史\\\",\\n            url: \\\"hiker://history?rule=\\\"+MY_RULE.title,\\n            col_type: \\\"scroll_button\\\"\\n        }, {\\n            title: bdyp_paixu,\\n            url: $(\\\"#noLoading#\\\").lazyRule(() => {\\n                if (getItem(\\\"bdyp_paixu\\\", \\\"↓按修改时间\\\") === \\\"↓按修改时间\\\") {\\n                    setItem(\\\"bdyp_paixu\\\", \\\"↑按修改时间\\\");\\n                } else {\\n                    setItem(\\\"bdyp_paixu\\\", \\\"↓按修改时间\\\");\\n                }\\n                refreshPage();\\n                toast(\\\"设置成功\\\");\\n                return \\\"hiker://empty\\\";\\n            }),\\n            col_type: \\\"scroll_button\\\"\\n        });\\n        setPreResult(d1);\\n    }\\n    let html1 = get1(host1+\\\"/api/list?clienttype=0&app_id=250528&web=1&order=time&desc=\\\"+(bdyp_paixu === \\\"↓按修改时间\\\" ? \\\"1\\\" : \\\"0\\\")+\\\"&dir=\\\"+encodeURIComponent(dir)+\\\"&num=100&page=1&limit=100\\\", header1); //log(html1)\\n    if (html1.errno === 0) {\\n        html1.list.forEach(it => {\\n            const {isdir, category, server_filename, server_mtime, size, path} = it;\\n            const longclick = [{\\n                title: \\\"删除\\\",\\n                js: $.toString((path) => {\\n                    return $.require(\\\"hanshu\\\").shanchu(path);\\n                }, path)\\n            }, {\\n                title: \\\"重命名\\\",\\n                js: $.toString((path, server_filename) => {\\n                    return $.require(\\\"hanshu\\\").rename(path, server_filename);\\n                }, path, server_filename)\\n            }];\\n            let desc, img, url;\\n            if (isdir == 1) {\\n                desc = \\\"文件夹\\\"+\\\"  \\\"+formatTimestamp(server_mtime);\\n                img = \\\"hiker://images/icon_folder3\\\";\\n                url = $(\\\"hiker://empty\\\").rule((path) => {\\n                    $.require(\\\"hanshu\\\").shouye(path);\\n                }, path);\\n            } else {\\n                longclick.push({\\n                    title: \\\"下载\\\",\\n                    js: $.toString((path, category, size) => {\\n                        if (category === 1 || size < 52428800) {\\n                            let data = $.require(\\\"hanshu\\\").jiexi1(path, category, size);\\n                            let playHeader = Object.keys(data.header).map(key => key + \\\"@\\\" + String(data.header[key]).replace(/;/g, \\\"；；\\\"));\\n                            return \\\"download://\\\" + data.url + \\\";{\\\" + playHeader.join(\\\"&&\\\") + \\\"}\\\";\\n                        } else if (size < 314572800) {\\n                            let {jiexi1, preview_download} = $.require(\\\"hanshu\\\");\\n                            let data = jiexi1(path, category, size);\\n                            return preview_download(data.url);\\n                        } else {\\n                            toast(\\\"不支持下载\\\");\\n                            return \\\"hiker://empty\\\";\\n                        }\\n                    }, path, category, size)\\n                });\\n                desc = bytesToSize(size)+\\\"  \\\"+formatTimestamp(server_mtime);\\n                if (category === 1) {\\n                    img = it.thumbs.url3;\\n                    url = $(\\\"\\\").lazyRule((path, category, size) => {\\n                        return $.require(\\\"hanshu\\\").lazy1(path, category, size);\\n                    }, path, category, size);\\n                } else if (category === 2) {\\n                    img = \\\"hiker://images/icon_music3\\\";\\n                    url = $(\\\"\\\").lazyRule((path, category, size) => {\\n                        //return $.require(\\\"hanshu\\\").lazy1(path, category, size);\\n                    }, path, category, size);\\n                } else if (category === 3) {\\n                    img = it.thumbs.url3;\\n                    url = it.thumbs.url3+\\\"#.png\\\";\\n                } else if (category === 4) {\\n                    img = \\\"hiker://images/icon_txt2\\\";\\n                    url = $(\\\"\\\").lazyRule((path, category, size) => {\\n                        return $.require(\\\"hanshu\\\").lazy1(path, category, size);\\n                    }, path, category, size);\\n                } else if (category === 5) {\\n                    img = \\\"hiker://images/icon_app3\\\";\\n                    url = $(\\\"\\\").lazyRule((path, category, size) => {\\n                        return $.require(\\\"hanshu\\\").lazy1(path, category, size);\\n                    }, path, category, size);\\n                } else {\\n                    img = \\\"hiker://images/icon_unknown\\\";\\n                    url = $(\\\"\\\").lazyRule((path, category, size) => {\\n                        return $.require(\\\"hanshu\\\").lazy1(path, category, size);\\n                    }, path, category, size);\\n                }\\n            }\\n            d.push({\\n                title: server_filename,\\n                desc: desc,\\n                img: img,\\n                url: url,\\n                col_type: \\\"icon_1_left_pic\\\",\\n                extra: {\\n                    inheritTitle: false,\\n                    lineVisible: false,\\n                    longClick: longclick,\\n                    id: path\\n                }\\n            });\\n        });\\n    } else {\\n        d.push({\\n            title: \\\"登录过期\\\",\\n            desc: \\\"BDUSS\\\",\\n            url: \\\"hiker://empty\\\",\\n            col_type: \\\"text_center_1\\\",\\n            extra: {\\n                lineVisible: false\\n            }\\n        });\\n    }\\n    setResult(d);\\n}\\n\\nfunction jiexi1(path, category, size) {\\n    if (category === 1) {\\n        let header = Object.assign({}, header1, {\\\"User-Agent\\\": ua2});\\n        let bdyp_play_mode1 = getItem(\\\"bdyp_play_mode1\\\", \\\"TV原画\\\");\\n        let bdyp_play_mode2 = getItem(\\\"bdyp_play_mode2\\\");\\n        if (bdyp_play_mode1 === \\\"TV原画\\\" || bdyp_play_mode2 === \\\"TV原画(转存)\\\") {\\n            let html1 = get1(host1+\\\"/api/mediainfo?type=M3U8_FLV_264_480&path=\\\" + encodeURIComponent(path) + \\\"&clienttype=80&origin=dlna\\\", header); //log(html1)\\n            if (html1.info) {\\n                let dlink = html1.info.dlink; //log(dlink)\\n                let html2 = JSON.parse(fetch(dlink,{\\n                    headers: {\\n                        \\\"User-Agent\\\": ua2,\\n                        \\\"Range\\\": \\\"bytes=0-1\\\",\\n                        \\\"Cookie\\\": \\\"#noCookie#\\\"\\n                    },\\n                    method: \\\"GET\\\",\\n                    redirect: false,\\n                    onlyHeaders: true\\n                })); //log(html2)\\n                if (html2.statusCode === 302) {\\n                    let url = html2.headers.location[0]; log(url)\\n                    return {url: url, header: header};\\n                }\\n            }\\n        } else if (bdyp_play_mode1 === \\\"TV转码\\\" || bdyp_play_mode2 === \\\"TV转码(转存)\\\") {\\n            let adToken = get1(host1+\\\"/api/streaming?type=\\\"+\\\"M3U8_AUTO_1080\\\"+\\\"&path=\\\"+encodeURIComponent(path)+\\\"&clienttype=80\\\").adToken; //log(adToken)\\n            if (adToken) {\\n                let type = [\\\"M3U8_AUTO_4K\\\", \\\"M3U8_AUTO_1080\\\", \\\"M3U8_AUTO_720\\\", \\\"M3U8_AUTO_480\\\"];\\n                for (let i=0; i<4; i++) {\\n                    let url = host1+\\\"/api/streaming?type=\\\"+type[i]+\\\"&path=\\\"+encodeURIComponent(path)+\\\"&clienttype=80\\\"+\\\"&adToken=\\\"+encodeURIComponent(adToken); log(url)\\n                    let html1 = fetch(url, {\\n                        headers: header,\\n                        method: \\\"GET\\\",\\n                    });\\n                    if (html1.includes(\\\"#EXTM3U\\\")) {\\n                        writeFile(\\\"hiker://files/_cache/video.m3u8\\\", html1);\\n                        //return {url: url, header: header};\\n                        return {url: getPath(\\\"hiker://files/_cache/video.m3u8\\\"), header: header};\\n                    }\\n                }\\n            }\\n        }\\n    } else {\\n        let header = Object.assign({}, header1, {\\\"User-Agent\\\": ua3});\\n        let html1 = get1(\\\"https://d.pcs.baidu.com/rest/2.0/pcs/file?app_id=250528&method=locatedownload&path=\\\"+encodeURIComponent(path)+\\\"&use=1\\\", header); //log(html1) \\n        let url = html1.urls[0].url; log(url)\\n        if (size < 52428800) {\\n            return {url: url, header: header1};\\n        } else {\\n            return {url: url, header: header};\\n        }\\n    }\\n}\\n\\nfunction lazy1(path, category, size) {\\n    let data = jiexi1(path, category, size);\\n    if (category === 1) {\\n        if (data.url.includes(\\\"video.m3u8\\\")) {\\n            let url = startProxyServer($.toString(() => {\\n                return {\\n                    body: readFile(\\\"hiker://files/download/video.m3u8\\\"),\\n                    headers: {\\n                        'Content-Type': 'application/x-mpegURL'\\n                    },\\n                    statusCode: 200\\n                };\\n            }))\\n            url = url + '?u=' + base64Encode(data.url) + \\\"#isVideo=true##fastPlayMode##threads=10#\\\"\\n            return JSON.stringify({\\n                urls: [url]\\n            });\\n        } else {\\n            return JSON.stringify({\\n                urls: [data.url+\\\"#isVideo=true##fastPlayMode##threads=10#\\\"],\\n                headers: [data.header]\\n            });\\n        }\\n    } else {\\n        if (size < 52428800) {\\n            return \\\"download://\\\" + data.url;\\n        } else if (size < 314572800) {\\n            return preview_download(data.url);\\n        } else {\\n            toast(\\\"不支持下载\\\");\\n            return \\\"hiker://empty\\\";\\n        }\\n    }\\n}\\n\\nfunction gethtml(path1) {\\n    let url = host1+\\\"/s/\\\"+path1;\\n    let html1 = JSON.parse(fetch(url, {\\n        headers: {\\n            \\\"User-Agent\\\": ua1,\\n            \\\"Cookie\\\": \\\"#noCookie#\\\"\\n        },\\n        method: \\\"HEAD\\\",\\n        redirect: false,\\n        onlyHeaders: true\\n    })); //log(html1)\\n    if (html1.statusCode === 302) {\\n        let url1 = html1.headers.location[0]; //log(url1)\\n        let html2 = JSON.parse(fetch(host1+url1.replace(\\\"/share/init\\\", \\\"/share/verify\\\"), {\\n            headers: {\\n                \\\"User-Agent\\\": ua1,\\n                \\\"Referer\\\": host1+url1,\\n                \\\"Cookie\\\": \\\"#noCookie#\\\"\\n            },\\n            body: \\\"pwd=\\\"+url.match(/pwd=(\\\\w+)/)[1]+\\\"&vcode=&vcode_str=\\\",\\n            method: \\\"POST\\\"\\n        })); //log(html2)\\n        let BDCLND = html2.randsk;\\n        url1 = url1.match(/surl=(.{22})&pwd=(\\\\w+)/);\\n        if (url1) return {surl: url1[1], pwd: url1[2], BDCLND: BDCLND};\\n    } else {\\n        return {surl: path1.match(/(.{23})/)[1], pwd: path1.match(/pwd=(\\\\w+)/)[1]};\\n    }\\n}\\n\\nfunction search1(data) {\\n    log(data)\\n    let d = [];\\n    let page = MY_PAGE;\\n    let bdyp_paixu = getItem(\\\"bdyp_paixu\\\", \\\"↓按修改时间\\\");\\n    if (page === 1) {\\n        let d1 = [];\\n        d1.push({\\n            title: \\\"界面设置\\\",\\n            img: \\\"hiker://images/icon_menu6\\\",\\n            url: \\\"select://\\\"+JSON.stringify({\\n                \\\"title\\\": \\\"盘外\\\",\\n                \\\"options\\\": [\\\"视频\\\"],\\n                col: 1,\\n                js: $.toString(()=>{\\n                    return $.require(\\\"hanshu\\\").setting1(input, \\\"盘外\\\");\\n                })\\n            }),\\n            col_type: \\\"icon_2_round\\\"\\n        });\\n        d1.push({\\n            title: \\\"账号设置\\\",\\n            img: \\\"hiker://images/icon_setting6\\\",\\n            url: $([\\\"网页登录\\\", \\\"扫码登录\\\", \\\"Cookie登录\\\", \\\"复制Cookie\\\", \\\"清除Cookie\\\"]).select(() => {\\n                return $.require(\\\"account\\\").account_setting(input);\\n            }),\\n            col_type: \\\"icon_2_round\\\"\\n        });\\n        d1.push({\\n            title: host1+\\\"/s/1\\\"+data.surl+\\\"?pwd=\\\"+data.pwd,\\n            desc: \\\"点我复制分享链接\\\",\\n            url: \\\"copy://\\\"+host1+\\\"/s/1\\\"+data.surl+\\\"?pwd=\\\"+data.pwd,\\n            col_type: \\\"text_center_1\\\",\\n            extra: {\\n                lineVisible: false\\n            }\\n        });\\n        d1.push({\\n            title: \\\"♥收藏\\\",\\n            url: \\\"hiker://collection?rule=\\\"+MY_RULE.title,\\n            col_type: \\\"scroll_button\\\"\\n        }, {\\n            title: \\\"✿历史\\\",\\n            url: \\\"hiker://history?rule=\\\"+MY_RULE.title,\\n            col_type: \\\"scroll_button\\\"\\n        }, {\\n            title: bdyp_paixu,\\n            url: $(\\\"#noLoading#\\\").lazyRule(() => {\\n                if (getItem(\\\"bdyp_paixu\\\", \\\"↓按修改时间\\\") === \\\"↓按修改时间\\\") {\\n                    setItem(\\\"bdyp_paixu\\\", \\\"↑按修改时间\\\");\\n                } else {\\n                    setItem(\\\"bdyp_paixu\\\", \\\"↓按修改时间\\\");\\n                }\\n                refreshPage();\\n                toast(\\\"设置成功\\\");\\n                return \\\"hiker://empty\\\";\\n            }),\\n            col_type: \\\"scroll_button\\\"\\n        });\\n        setPreResult(d1);\\n    }\\n    let header = Object.assign({}, header1, {\\\"Cookie\\\": \\\"BDCLND=\\\"+data.BDCLND});\\n    let html1;\\n    if (!data.dir) {\\n        html1 = get1(host1+\\\"/share/list?web=5&app_id=250528&desc=\\\"+(bdyp_paixu === \\\"↓按修改时间\\\" ? \\\"1\\\" : \\\"0\\\")+\\\"&showempty=0&page=1&num=20&order=time&shorturl=\\\"+data.surl+\\\"&root=1&view_mode=1&channel=chunlei&web=1&clienttype=0\\\", header); //log(html1)\\n        setPageTitle(html1.title || \\\"\\\");\\n    } else {\\n        let dir;\\n        if (data.dir.startsWith(\\\"/我的资源/\\\")) {\\n            dir = data.dir.replace(\\\"我的资源\\\", \\\"sharelink\\\"+data.uk+\\\"-\\\"+data.fs_id);\\n        } else {\\n            dir = data.dir;\\n        }\\n        html1 = get1(host1+\\\"/share/list?is_from_web=true&uk=\\\"+data.uk+\\\"&shareid=\\\"+data.shareid+\\\"&order=name&desc=\\\"+(bdyp_paixu === \\\"↓按修改时间\\\" ? \\\"1\\\" : \\\"0\\\")+\\\"&showempty=0&view_mode=1&web=1&page=1&num=100&dir=\\\"+encodeURIComponent(dir)+\\\"&channel=chunlei&web=1&app_id=250528&clienttype=0\\\", header); //log(html1)\\n    }\\n    if (html1.errno === 0) {\\n        let uk = html1.uk.toString();\\n        let share_id = html1.share_id.toString();\\n        html1.list.forEach(it => {\\n            const {isdir, category, server_filename, server_mtime, size, path, fs_id} = it;\\n            const datas = Object.assign({}, data, {uk: uk, shareid: share_id, fs_id: fs_id, dir: path, category: category, size: size});\\n            const longclick = [{\\n                title: \\\"转存\\\",\\n                js: $.toString((data) => {\\n                    if ($.require(\\\"hanshu\\\").zhuancun(data) !== undefined) toast(\\\"转存成功\\\"); return \\\"hiker://empty\\\";\\n                }, datas)\\n            }];\\n            let desc, img, url;\\n            if (isdir == 1) {\\n                desc = \\\"文件夹\\\"+\\\"  \\\"+formatTimestamp(server_mtime);\\n                img = \\\"hiker://images/icon_folder3\\\";\\n                url = $(\\\"hiker://empty\\\").rule((data) => {\\n                    $.require(\\\"hanshu\\\").search1(data);\\n                }, datas);\\n            } else {\\n                longclick.push({\\n                    title: \\\"下载\\\",\\n                    js: $.toString((datas) => {\\n                        \\n                        if (datas.category === 1 || datas.size < 52428800) {\\n                            let data = $.require(\\\"hanshu\\\").jiexi2(datas);\\n                            let playHeader = Object.keys(data.header).map(key => key + \\\"@\\\" + String(data.header[key]).replace(/;/g, \\\"；；\\\"));\\n                            return \\\"download://\\\" + data.url + \\\";{\\\" + playHeader.join(\\\"&&\\\") + \\\"}\\\";\\n                        } else if (datas.size < 314572800) {\\n                            let {jiexi2, preview_download} = $.require(\\\"hanshu\\\");\\n                            let data = jiexi2(datas);\\n                            return preview_download(data.url);\\n                        } else {\\n                            toast(\\\"不支持下载\\\");\\n                            return \\\"hiker://empty\\\";\\n                        }\\n                        \\n                    }, datas)\\n                });\\n                desc = bytesToSize(size)+\\\"  \\\"+formatTimestamp(server_mtime);\\n                if (category === 1) {\\n                    img = it.thumbs.url3;\\n                    url = $(\\\"\\\").lazyRule((data) => {\\n                        return $.require(\\\"hanshu\\\").lazy2(data);\\n                    }, datas);\\n                } else if (category === 2) {\\n                    img = \\\"hiker://images/icon_music3\\\";\\n                    url = $(\\\"\\\").lazyRule((data) => {\\n                        //return $.require(\\\"hanshu\\\").lazy2(data);\\n                    }, datas);\\n                } else if (category === 3) {\\n                    img = it.thumbs.url3;\\n                    url = it.thumbs.url3+\\\"#.png\\\";\\n                } else if (category === 4) {\\n                    img = \\\"hiker://images/icon_txt2\\\";\\n                    url = $(\\\"\\\").lazyRule((data) => {\\n                        return $.require(\\\"hanshu\\\").lazy2(data);\\n                    }, datas);\\n                } else if (category === 5) {\\n                    img = \\\"hiker://images/icon_app3\\\";\\n                    url = $(\\\"\\\").lazyRule((data) => {\\n                        return $.require(\\\"hanshu\\\").lazy2(data);\\n                    }, datas);\\n                } else {\\n                    img = \\\"hiker://images/icon_unknown\\\";\\n                    url = $(\\\"\\\").lazyRule((data) => {\\n                        return $.require(\\\"hanshu\\\").lazy2(data);\\n                    }, datas);\\n                }\\n            }\\n            d.push({\\n                title: server_filename,\\n                desc: desc,\\n                img: img,\\n                url: url,\\n                col_type: \\\"icon_1_left_pic\\\",\\n                extra: {\\n                    inheritTitle: false,\\n                    lineVisible: false,\\n                    longClick: longclick,\\n                    id: path\\n                }\\n            });\\n        });\\n    } else {\\n        d.push({\\n            title: html1.show_msg,\\n            desc: \\\"点我访问分享链接\\\",\\n            url: host1+\\\"/s/1\\\"+data.surl+\\\"?pwd=\\\"+data.pwd,\\n            col_type: \\\"text_center_1\\\",\\n            extra: {\\n                lineVisible: false\\n            }\\n        });\\n    }\\n    setResult(d);\\n}\\n\\nfunction jiexi2(data) {\\n    let category = data.category;\\n    let bdyp_play_mode2 = getItem(\\\"bdyp_play_mode2\\\", \\\"APP原画(不转存)\\\");\\n    if (bdyp_play_mode2 === \\\"APP原画(不转存)\\\") {\\n        if (category === 1) {\\n            eval(getCryptoJS());\\n            function sha1(message) {\\n                let hash = CryptoJS.SHA1(message);\\n                return hash.toString(CryptoJS.enc.Hex);\\n            }\\n            let header = Object.assign({}, header1, {\\\"User-Agent\\\": ua3});\\n            let devuid = \\\"73CED981D0F186D12BC18CAE1684FFD5|VSRCQTF6W\\\";\\n            let time = String(new Date().getTime());\\n            let rand = sha1(sha1(getItem(\\\"cookie\\\").match(/BDUSS=(.+?);/)[1])+\\\"3528972618ebrcUYiuxaZv2XGu7KIYKxUrqfnOfpDF\\\"+time+devuid+\\\"11.30.2ae5821440fab5e1a61a025f014bd8972\\\");\\n            let url1 = host1+\\\"/share/list?shareid=\\\"+data.shareid+\\\"&uk=\\\"+data.uk+\\\"&fid=\\\"+data.fs_id+\\\"&sekey=\\\"+data.BDCLND+\\\"&origin=dlna&devuid=\\\"+devuid+\\\"&clienttype=1&channel=android_12_zhao_bd-netdisk_1024266h&version=11.30.2&time=\\\"+time+\\\"&rand=\\\"+rand; \\n            let html1 = JSON.parse(fetch(url1, {\\n                headers: header,\\n                method: \\\"GET\\\"\\n            })); //log(html1)\\n            if (html1.errno === 0) {\\n                let url2 = html1.list[0].dlink;\\n                let html2 = JSON.parse(fetch(url2, {\\n                    headers: header,\\n                    method: \\\"GET\\\",\\n                    redirect: false,\\n                    onlyHeaders: true\\n                })); //log(html2)\\n                if (html2.statusCode === 302) {\\n                    let url = html2.headers.location[0];\\n                    return {url: url, header: header};\\n                }\\n            }\\n        } else {\\n            eval(getCryptoJS());\\n            function sha1(message) {\\n                let hash = CryptoJS.SHA1(message);\\n                return hash.toString(CryptoJS.enc.Hex);\\n            }\\n            let header = Object.assign({}, header1, {\\\"User-Agent\\\": ua3});\\n            let devuid = \\\"73CED981D0F186D12BC18CAE1684FFD5|VSRCQTF6W\\\";\\n            let time = String(new Date().getTime());\\n            let rand = sha1(sha1(getItem(\\\"cookie\\\").match(/BDUSS=(.+?);/)[1])+\\\"3528972618ebrcUYiuxaZv2XGu7KIYKxUrqfnOfpDF\\\"+time+devuid+\\\"11.30.2ae5821440fab5e1a61a025f014bd8972\\\");\\n            let url1 = host1+\\\"/share/list?shareid=\\\"+data.shareid+\\\"&uk=\\\"+data.uk+\\\"&fid=\\\"+data.fs_id+\\\"&sekey=\\\"+data.BDCLND+\\\"&devuid=\\\"+devuid+\\\"&clienttype=1&channel=android_12_zhao_bd-netdisk_1024266h&version=11.30.2&time=\\\"+time+\\\"&rand=\\\"+rand; \\n            let html1 = JSON.parse(fetch(url1, {\\n                headers: header,\\n                method: \\\"GET\\\"\\n            })); //log(html1)\\n            if (html1.errno === 0) {\\n                let url2 = html1.list[0].dlink.match(/\\\\/file\\\\/(\\\\w+)\\\\?(.+)/); //log(url2)\\n                url2 = \\\"https://d.pcs.baidu.com/rest/2.0/pcs/file?app_id=250528&method=locatedownload&path=\\\"+url2[1]+\\\"&\\\"+url2[2]+\\\"&use=1\\\"; //log(url2)\\n                let html2 = JSON.parse(fetch(url2, {\\n                    headers: header,\\n                    method: \\\"GET\\\",\\n                })); //log(html2)\\n                let url = html2.urls[0].url;\\n                if (data.size < 52428800) {\\n                    return {url: url, header: header1};\\n                } else {\\n                    return {url: url, header: header};\\n                }\\n            }\\n        }\\n    } else if (bdyp_play_mode2 === \\\"网页转码(不转存)\\\") {\\n        if (category === 1) {\\n        let url1 = host1+\\\"/share/tplconfig?surl=\\\"+\\\"1\\\"+data.surl+\\\"&fields=sign,timestamp\\\";\\n        let html1 = JSON.parse(fetch(url1, {\\n            headers: {\\n                \\\"Cookie\\\": \\\"#noCookie#\\\"\\n            },\\n            method: \\\"GET\\\"\\n        })); //log(html1)\\n        if (html1.errno === 0) {\\n            let type = [\\\"M3U8_AUTO_4K\\\", \\\"M3U8_AUTO_1080\\\", \\\"M3U8_AUTO_720\\\", \\\"M3U8_AUTO_480\\\"];\\n            for (let i=0; i<4; i++) {\\n                let url = host1+\\\"/share/streaming?uk=\\\"+data.uk+\\\"&fid=\\\"+data.fs_id+\\\"&sign=\\\"+html1.data.sign+\\\"&timestamp=\\\"+html1.data.timestamp+\\\"&shareid=\\\"+data.shareid+\\\"&type=\\\"+type[i]+\\\"&jsToken\\\"; //log(url)\\n                let html2 = fetch(url, {\\n                    headers: header1,\\n                    method: \\\"GET\\\",\\n                }); //log(html2)\\n                if (html2.includes(\\\"#EXTM3U\\\")) {\\n                    writeFile(\\\"hiker://files/_cache/video.m3u8\\\", html2);\\n                    return {url: getPath(\\\"hiker://files/_cache/video.m3u8\\\"), header: header1};\\n                }\\n            }\\n        }\\n        }\\n    } else if (bdyp_play_mode2 === \\\"TV原画(转存)\\\") {\\n        let list = $.require(\\\"hanshu\\\").zhuancun(data);\\n        if (list) {\\n            let url = jiexi1(list.to, data.category, data.size);\\n            shanchu(list.to);\\n            return url;\\n        }\\n    } else if (bdyp_play_mode2 === \\\"TV转码(转存)\\\") {\\n        let list = $.require(\\\"hanshu\\\").zhuancun(data);\\n        if (list) {\\n            let url = jiexi1(list.to, data.category, data.size);\\n            shanchu(list.to);\\n            return url;\\n        }\\n    }\\n}\\n\\nfunction lazy2(datas) {\\n    let data = jiexi2(datas);\\n    if (datas.category === 1) {\\n        if (data.url.includes(\\\"video.m3u8\\\")) {\\n            let url = startProxyServer($.toString(() => {\\n                return {\\n                    body: readFile(\\\"hiker://files/download/video.m3u8\\\"),\\n                    headers: {\\n                        'Content-Type': 'application/x-mpegURL'\\n                    },\\n                    statusCode: 200\\n                };\\n            }))\\n            url = url + '?u=' + base64Encode(data.url) + \\\"#isVideo=true##fastPlayMode##threads=10#\\\"\\n            return JSON.stringify({\\n                urls: [url]\\n            });\\n        } else {\\n            return JSON.stringify({\\n                urls: [data.url+\\\"#isVideo=true##fastPlayMode##threads=10#\\\"],\\n                headers: [data.header]\\n            });\\n        }\\n    } else {\\n        if (datas.size < 52428800) {\\n            return \\\"download://\\\" + data.url;\\n        } else if (datas.size < 314572800) {\\n            return preview_download(data.url);\\n        } else {\\n            toast(\\\"不支持下载\\\");\\n            return \\\"hiker://empty\\\";\\n        }\\n    }\\n}\\n\\n// 取文件名后缀\\nfunction getHzm(fileName) {\\n    return fileName.substr(fileName.lastIndexOf(\\\".\\\") + 1).toLowerCase();\\n}\\n\\n// by LoyDgIk 佬\\nfunction bytesToSize(size) {\\n    if (!size) {\\n        return \\\"0\\\";\\n    }\\n    const units = [\\\"B\\\", \\\"KB\\\", \\\"MB\\\", \\\"GB\\\", \\\"TB\\\", \\\"PB\\\", \\\"EB\\\", \\\"ZB\\\", \\\"YB\\\"];\\n    let i = 0;\\n    while (size >= 1024) {\\n        size /= 1024;\\n        i++;\\n    }\\n    size = i ? Number(size.toFixed(2)) : size;\\n    return `${size} ${units[i]}`;\\n}\\n\\nfunction formatTimestamp(timestamp) {\\n    // 确保时间戳是数字类型并转换\\n    let ts = +timestamp; // 使用一元加号，确保转换为数字\\n    // 如果时间戳是秒级（10位），转换为毫秒级（13位）\\n    ts = ts < 1e12 ? ts * 1000 : ts;\\n    // 创建日期对象\\n    let date = new Date(ts);\\n    // 格式化：通过小函数来补零，避免重复代码\\n    let pad = (num) => num.toString().padStart(2, '0');\\n    // 返回完整日期格式，精确到时分\\n    return `${date.getFullYear()}-${pad(date.getMonth() + 1)}-${pad(date.getDate())} ${pad(date.getHours())}:${pad(date.getMinutes())}`;\\n}\\n\\nfunction preview_download(url) {\\n    toast(\\\"开始下载\\\");\\n    let BaiduMultiThreadedDownloader = GM.defineModule(\\\"BaiduMultiThreadedDownloader\\\");\\n    return BaiduMultiThreadedDownloader.downloadFile(url, getPath(\\\"hiker://files/download/\\\").replace(\\\"file://\\\", \\\"\\\"), null, {\\n        headers: {\\n            \\\"User-Agent\\\": ua3,\\n            \\\"Range\\\": \\\"0-1\\\"\\n        },\\n        threadCount: 6,\\n        //chunkSize: 140068\\n    }) ? toast(\\\"下载完成\\\") : toast(\\\"请等待下载结束\\\");\\n}\\n\\n// 文件转存函数\\nfunction zhuancun(data) {\\n    let html1 = JSON.parse(fetch(host1+\\\"/share/transfer\\\", {\\n        headers: {\\n            \\\"User-Agent\\\": \\\"Android\\\",\\n            \\\"Referer\\\": host1,\\n            \\\"Cookie\\\": \\\"BDCLND=\\\"+data.BDCLND+\\\"; \\\"+cookie1\\n        },\\n        body: \\\"from=\\\"+data.uk+\\\"&shareid=\\\"+data.shareid+\\\"&ondup=newcopy&path=\\\"+encodeURIComponent(\\\"/\\\")+\\\"&fsidlist=\\\"+encodeURIComponent(\\\"[\\\"+data.fs_id+\\\"]\\\"),\\n        method: \\\"POST\\\",\\n        rejectCoding: true\\n    })); //log(html1)\\n    if (html1.errno === 0) {\\n        return html1.extra.list[0];\\n    } else {\\n        return toast(html1.show_msg);\\n    }\\n}\\n\\n// 文件删除函数\\nfunction shanchu(path) {\\n    let html1 = JSON.parse(fetch(host1+\\\"/api/filemanager?opera=delete&clienttype=1\\\", {\\n        headers: {\\n            \\\"User-Agent\\\": \\\"Android\\\",\\n            \\\"Cookie\\\": cookie1,\\n        },\\n        body: 'filelist='+encodeURIComponent('[\\\"'+path+'\\\"]'),\\n        method: \\\"POST\\\",\\n        rejectCoding: true\\n    })); //log(html1)\\n    if (html1.errno === 0) {\\n        toast(\\\"已删除\\\");\\n    } else {\\n        toast(\\\"删除失败\\\");\\n    }\\n}\\n\\n// 文件重命名函数\\nfunction rename(path, server_filename) {\\n    return $(server_filename, server_filename).input((path) => {\\n        let html1 = JSON.parse(fetch(\\\"https://pan.baidu.com/api/filemanager?opera=rename&clienttype=1\\\", {\\n            headers: {\\n                \\\"User-Agent\\\": \\\"Android\\\",\\n                \\\"Cookie\\\": getItem(\\\"cookie\\\"),\\n            },\\n            body: \\\"filelist=\\\"+encodeURIComponent(`[{\\\"path\\\":\\\"${path}\\\",\\\"newname\\\":\\\"${input}\\\"}]`)+\\\"&async=2&ondup=fail\\\",\\n            method: 'POST',\\n            rejectCoding: true\\n        })); //log(html1)\\n        if (html1.errno === 0) {\\n            toast(\\\"重命名成功\\\");\\n        } else {\\n            toast(\\\"重命名失败\\\");\\n        }\\n    }, path)\\n}\\n\\n$.exports = {\\n    shouye,\\n    jiexi1,\\n    lazy1,\\n    gethtml,\\n    search1,\\n    jiexi2,\\n    lazy2,\\n    preview_download,\\n    zhuancun,\\n    shanchu,\\n    rename,\\n    setting1\\n}\"},{\"col_type\":\"movie_3\",\"name\":\"账号\",\"path\":\"account\",\"rule\":\"$.exports.account_setting = function(input) {\\n    if (input === \\\"网页登录\\\") {\\n        return $(\\\"hiker://empty#noRecordHistory##noHistory#\\\").rule(() => {\\n            let d = [];\\n            setPageTitle(\\\"登录账号\\\");\\n            d.push({\\n                title: \\\"““确认登录””\\\",\\n                desc: \\\"““””<small>点击头像可以退出账号重新登录</small>\\\",\\n                url: $(\\\"#noLoading#\\\").lazyRule(() => {\\n                    let cookie = getMyVar(\\\"cookie\\\", \\\"\\\"); //log(cookie)\\n                    if (cookie.includes(\\\"BDUSS=\\\") && cookie.includes(\\\"PTOKEN=\\\")) {\\n                        let BDUSS = cookie.match(/BDUSS=.+?;/)[0];\\n                        log(BDUSS)\\n                        let PTOKEN = cookie.match(/PTOKEN=.+?;/)[0];\\n                        log(PTOKEN)\\n                        let header1 = {\\n                            \\\"User-Agent\\\": \\\"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36\\\",\\n                            \\\"Cookie\\\": BDUSS\\n                        };\\n\\n                        function get1(url1, header1) {\\n                            let html1 = JSON.parse(fetch(url1, {\\n                                headers: header1,\\n                                method: \\\"GET\\\",\\n                                redirect: false,\\n                                onlyHeaders: true\\n                            })); //log(html1)\\n                            return html1;\\n                        }\\n                        let html1 = get1(\\\"https://pan.baidu.com/disk/home\\\", header1); //log(html1)\\n                        if (html1.statusCode === 302) {\\n                            let url1 = html1.headers.location[0];\\n                            let html2 = get1(url1, Object.assign({}, header1, {\\n                                \\\"Cookie\\\": PTOKEN + BDUSS\\n                            })); //log(html2)\\n                            if (html2.statusCode === 302) {\\n                                let url2 = html2.headers.location[0];\\n                                let html3 = get1(url2, header1); //log(html3)\\n                                if (html3.statusCode === 302) {\\n                                    let set_cookie3 = html3.headers[\\\"set-cookie\\\"].join(\\\"  \\\"); //log(set_cookie3)\\n                                    if (set_cookie3.includes(\\\"STOKEN=\\\")) {\\n                                        let STOKEN = set_cookie3.match(/STOKEN=.+?;/)[0];\\n                                        log(STOKEN)\\n                                        setItem(\\\"cookie\\\", BDUSS + STOKEN);\\n                                        toast(\\\"登录成功\\\");\\n                                        back(true);\\n                                        return \\\"hiker://empty\\\";\\n                                    }\\n                                }\\n                            }\\n                        }\\n                    }\\n                    toast(\\\"登录失败\\\");\\n                    return \\\"hiker://empty\\\";\\n                }),\\n                col_type: \\\"text_center_1\\\"\\n            });\\n            d.push({\\n                col_type: \\\"line_blank\\\"\\n            });\\n            let durl = \\\"https://passport.baidu.com/\\\";\\n            d.push({\\n                desc: \\\"list&&screen-150\\\",\\n                url: durl,\\n                col_type: \\\"x5_webview_single\\\",\\n                extra: {\\n                    ua: PC_UA,\\n                    js: $.toString((title, durl) => {\\n                        let cookie = \\\"\\\";\\n                        setInterval(() => {\\n                            cookie = fba.getCookie(durl);\\n                            if (cookie.includes(\\\"BDUSS=\\\") && cookie.includes(\\\"PTOKEN=\\\")) {\\n                                fba.putVar(title + \\\"@cookie\\\", cookie);\\n                            }\\n                        }, 200);\\n                    }, MY_RULE.title, durl)\\n                }\\n            });\\n            setResult(d);\\n        });\\n    } else if (input === \\\"Cookie登录\\\") {\\n        return $(\\\"\\\", \\\"填写获取到的Cookie\\\").input(() => {\\n            if (input.includes(\\\"BDUSS=\\\") && input.includes(\\\"STOKEN=\\\")) {\\n                setItem(\\\"cookie\\\", input);\\n                toast(\\\"登录成功\\\");\\n                refreshPage();\\n            } else {\\n                return toast(\\\"cookie错误\\\");\\n            }\\n        });\\n    } else if (input === \\\"复制Cookie\\\") {\\n        copy(getItem(\\\"cookie\\\"));\\n        return toast(\\\"复制成功\\\");\\n    } else if (input === \\\"清除Cookie\\\") {\\n        clearItem(\\\"cookie\\\");\\n        toast(\\\"清除成功\\\");\\n        refreshPage();\\n    } else if (input === \\\"扫码登录\\\") {\\n        // 道长群嗷呜大佬提供\\n        return $(\\\"hiker://empty#noRecordHistory##noHistory#\\\").rule(() => {\\n            try {\\n                function generateRandomUUID() {\\n                    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\\n                        var r = Math.random() * 16 | 0,\\n                            v = c === 'x' ? r : (r & 0x3 | 0x8);\\n                        return v.toString(16);\\n                    });\\n                }\\n                function getjson(data) {\\n                    let start_idx = data.indexOf('(') + 1;\\n                    let end_idx = data.lastIndexOf(')');\\n                    if (start_idx > 0 && end_idx > 0) {\\n                        let json_str = data.substring(start_idx, end_idx);\\n                        json_str = json_str.replaceAll('&quot;', '\\\"').replaceAll(\\\"'\\\", '\\\"')\\n                        let json_obj = JSON.parse(json_str)\\n                        return json_obj\\n                    }\\n                }\\n                let ljurl = 'https://passport.baidu.com/v2/api/getqrcode'\\n                let usurl = 'https://passport.baidu.com/channel/unicast'\\n                let sturl = 'https://passport.baidu.com/v3/login/main/qrbdusslogin'\\n                let sturl1 = 'https://passport.baidu.com/v3/login/api/auth/?return_type=5&tpl=netdisk&u=https://pan.baidu.com/disk/home'\\n                let request_id = generateRandomUUID();\\n                let t3 = new Date().getTime().toString()\\n                let t1 = Math.floor(new Date().getTime() / 1000).toString()\\n                let headers = {\\n                    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; ) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.61 Chrome/126.0.6478.61 Not/A)Brand/8  Safari/537.36',\\n                    'sec-ch-ua-platform': '\\\"Windows\\\"',\\n                    'sec-ch-ua': '\\\"Not/A)Brand\\\";v=\\\"8\\\", \\\"Chromium\\\";v=\\\"126\\\", \\\"Google Chrome\\\";v=\\\"126\\\"',\\n                    'DNT': '1',\\n                    'sec-ch-ua-mobile': '?0',\\n                    'Sec-Fetch-Site': 'same-site',\\n                    'Sec-Fetch-Mode': 'no-cors',\\n                    'Sec-Fetch-Dest': 'script',\\n                    'Referer': 'https://pan.baidu.com/',\\n                    'Accept-Language': 'zh-CN,zh;q=0.9',\\n                }\\n                // 获取二维码链接\\n                let guidt = t3\\n                let ljparams = {\\n                    'lp': 'pc',\\n                    'qrloginfrom': 'pc',\\n                    'gid': request_id,\\n                    'callback': `tangram_guid_${t3}`,\\n                    'apiver': 'v3',\\n                    'tt': t3,\\n                    'tpl': 'netdisk',\\n                    'logPage': `traceId:pc_loginv5_${t1},logPage:loginv5`,\\n                    '_': t3\\n                }\\n                let qrdata = getjson(fetch(buildUrl(ljurl, ljparams), {\\n                    headers: headers\\n                }))\\n                let qrurl = qrdata.imgurl\\n                let channel_id = qrdata.sign\\n                let q = []\\n                q.push({\\n                    url: $(`https://${qrurl}#.jpg`, headers).image(),\\n                    col_type: \\\"pic_1_full\\\",\\n                    pic_url: $(`https://${qrurl}`, headers).image(),\\n                });\\n                setResult(q);\\n                // createQRCode(`https://${qrurl}`, false);\\n                // 获取bduss\\n                let bduss = \\\"\\\";\\n                for (let i = 0, ec = 0; i < 30; i++) {\\n                    java.lang.Thread.sleep(2000);\\n                    try {\\n                        let usparams = {\\n                            'channel_id': channel_id,\\n                            'gid': request_id,\\n                            'tpl': 'netdisk',\\n                            '_sdkFrom': '1',\\n                            'callback': `tangram_guid_${guidt}`,\\n                            'apiver': 'v3',\\n                            'tt': t3,\\n                            '_': t3,\\n                        }\\n                        let usdata = getjson(fetch(buildUrl(usurl, usparams), {\\n                            headers: headers\\n                        }))\\n                        if (usdata.channel_v) {\\n                            let bddata = JSON.parse(usdata.channel_v);\\n                            if (bddata.v) {\\n                                bduss = bddata.v\\n                                break;\\n                            }\\n                            continue\\n                        }\\n                    } catch (e) {\\n                        ec++;\\n                        if (ec >= 5) {\\n                            return \\\"toast://查询二维码出错\\\";\\n                        }\\n                    }\\n                }\\n                let stparams = {\\n                    'v': t3,\\n                    'bduss': bduss,\\n                    'u': 'https://pan.baidu.com/disk/main%23/index?category%3Dall',\\n                    'loginVersion': 'v5',\\n                    'qrcode': '1',\\n                    'tpl': 'netdisk',\\n                    'maskId': '',\\n                    'fileId': '',\\n                    'apiver': 'v3',\\n                    'tt': t3,\\n                    'traceid': '',\\n                    'time': t1,\\n                    'alg': 'v3',\\n                    'elapsed': '1',\\n                    'callback': 'bd__cbs__tro4ll'\\n                }\\n                // 获取cookie\\n                let stdata = getjson(fetch(buildUrl(sturl, stparams), {\\n                    headers: headers\\n                }))\\n                if (stdata.data && stdata.data.session) {\\n                    let cdata = stdata.data.session;\\n                    let bduss = cdata.bduss\\n                    log('获取bduss:' + bduss)\\n                    let stoken = cdata.stoken\\n                    let ptoken = cdata.ptoken\\n                    let ubi = encodeURIComponent(cdata.ubi)\\n                    let cookies = {\\n                        'newlogin': '1',\\n                        'UBI': ubi,\\n                        'STOKEN': stoken,\\n                        'BDUSS': bduss,\\n                        'PTOKEN': ptoken,\\n                        'BDUSS_BFESS': bduss,\\n                        'STOKEN_BFESS': stoken,\\n                        'PTOKEN_BFESS': ptoken,\\n                        'UBI_BFESS': ubi,\\n                    }\\n                    function buildk(params) {\\n                        return Object.keys(params)\\n                            .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)\\n                            .join(';');\\n                    }\\n                    headers.Cookie = buildk(cookies)\\n                    let data = fetch(sturl1, {\\n                        headers: headers,\\n                        onlyHeaders: true,\\n                        redirect: false\\n                    })\\n                    let lur = JSON.parse(data).headers.location[0]\\n                    let ldata = fetch(lur, {\\n                        headers: headers,\\n                        onlyHeaders: true,\\n                        redirect: false\\n                    })\\n                    let ck = JSON.parse(ldata).headers['set-cookie']\\n                    let stokenCookie = ck.find(c => c.toLowerCase().includes('stoken'))\\n                    stokenCookie = stokenCookie.split(';')[0].split('=')[1]\\n                    log('获取stoken:' + stokenCookie)\\n                    setItem(\\\"cookie\\\", \\\"BDUSS=\\\" + cdata.bduss + \\\";\\\" + \\\"STOKEN=\\\" + stokenCookie + \\\";\\\");\\n                    back(true);\\n                }\\n            } catch (e) {\\n                toast(\\\"登录失败：\\\" + e.toString());\\n                back(false);\\n            }\\n        });\\n    }\\n}\"},{\"col_type\":\"movie_3\",\"name\":\"GA&GM\",\"path\":\"GA&GM.js\",\"rule\":\"//by LoyDgIk 佬\\nconst JavaMap = java.util.HashMap;\\nconst globalMapSymbol = Symbol(\\\"globalMap\\\");\\nconst mapSymbol = Symbol(\\\"myJavaMap\\\");\\nconst selfSymbol = Symbol(\\\"selfKey\\\");\\n\\nfunction getTypeName(obj) {\\n    return Object.prototype.toString.call(obj);\\n}\\n\\nconst protoDic = new Map([\\n    [\\\"[object Array]\\\", Array],\\n    [\\\"[object Date]\\\", Date],\\n    [\\\"[object Object]\\\", Object],\\n    [\\\"[object Promise]\\\", Promise],\\n    [\\\"[object Map]\\\", Map],\\n    [\\\"[object Symbol]\\\", Symbol],\\n    [\\\"[object Array]\\\", Array],\\n    [\\\"[object Function]\\\", Function],\\n    [\\\"Error\\\", Error],\\n    [\\\"TypeError\\\", TypeError],\\n    [\\\"EvalError\\\", EvalError],\\n    [\\\"SyntaxError\\\", SyntaxError],\\n    [\\\"ReferenceError\\\", ReferenceError],\\n    [\\\"RangeError\\\", RangeError]\\n]);\\n\\nfunction dealWithVal(val) {\\n    let typeName = getTypeName(val);\\n    let errorName;\\n    if (val instanceof java.lang.String) {\\n        return String(val);\\n    } else if (val instanceof java.lang.Double) {\\n        return Number(val);\\n    } else if (val instanceof java.lang.Boolean) {\\n        if (String(val) === \\\"true\\\") {\\n            val = true;\\n        } else {\\n            val = false;\\n        }\\n        return val;\\n    } else if (typeName === \\\"[object Error]\\\" && protoDic.has((errorName = val.toString()))) {\\n        val.__proto__ = val.__proto__ && Object.assign(Object.create(protoDic.get(typeName).prototype), val.__proto__);\\n        return val;\\n    } else if (typeName !== \\\"[object javaObject]\\\" && protoDic.has(typeName)) {\\n        val.__proto__ = val.__proto__ && Object.assign(Object.create(protoDic.get(typeName).prototype), val.__proto__);\\n        return val;\\n    }\\n    return val;\\n}\\n\\nfunction isString(str) {\\n    return typeof(str) === \\\"string\\\" || str instanceof java.lang.String;\\n}\\n\\nfunction GlobalVar(javaMap, selfKey) {\\n    this[globalMapSymbol] = javaMap;\\n    this[selfSymbol] = selfKey;\\n    this.raw = false;\\n}\\nObject.assign(GlobalVar.prototype, {\\n    getHashMap(symbol) {\\n        if (symbol !== mapSymbol) return null;\\n        if (this[mapSymbol]) return this[mapSymbol];\\n        let selfKey = this[selfSymbol];\\n        if (!selfKey) {\\n            throw Error(\\\"当前没有全局环境，请使用setSelfKey指定规则名\\\");\\n        }\\n        this[mapSymbol] = this[globalMapSymbol];\\n        return this[mapSymbol];\\n    },\\n    setSelfKey(key) {\\n        //if (!this[selfSymbol]) this[selfSymbol] = key;\\n        this[selfSymbol] = key;\\n    },\\n    getSelfKey(){\\n        return this[selfSymbol];\\n    },\\n    getMapKey(key) {\\n        return String(this[selfSymbol] + key);\\n    },\\n    get(key, def) {\\n        key = this.getMapKey(key);\\n        let hashMap = this.getHashMap(mapSymbol);\\n        if (!hashMap.containsKey(key)) return def;\\n        let val = hashMap.get(key);\\n        if (this.raw) {\\n            return val;\\n        } else {\\n            return dealWithVal(val);\\n        }\\n    },\\n    getRaw(key, def) {\\n        key = this.getMapKey(key);\\n        let hashMap = this.getHashMap(mapSymbol);\\n        if (!hashMap.containsKey(key)) return def;\\n        return hashMap.get(key);\\n    },\\n    useRaw(noUseRaw) {\\n        this.raw = !noUseRaw;\\n        return this;\\n    },\\n    put(key, val) {\\n        if (val === void 0) return;\\n        let hashMap = this.getHashMap(mapSymbol);\\n        hashMap.put(this.getMapKey(key), val);\\n        return val;\\n    },\\n    clearAll() {\\n        let self = this[selfSymbol];\\n        let hashMap = this.getHashMap(mapSymbol);\\n        this.getHashMap(mapSymbol).forEach((key, value) => {\\n            if (isString(key) && String(key).startsWith(self)) {\\n                hashMap.remove(key);\\n            }\\n        });\\n    },\\n    clear(key, call) {\\n        if (this.hasButNoCall(key)) {\\n            let hashMap = this.getHashMap(mapSymbol);\\n            if (typeof call === \\\"function\\\") {\\n                call(this.get(key));\\n            }\\n            hashMap.remove(this.getMapKey(key));\\n        }\\n    },\\n    has(key, call) {\\n        let mapKey = this.getMapKey(key);\\n        let hashMap = this.getHashMap(mapSymbol);\\n        let res = !!hashMap.containsKey(mapKey);\\n        if (res && typeof call === \\\"function\\\") {\\n            call(this.get(key));\\n        }\\n        return res;\\n    },\\n    hasButNoCall(key) {\\n        let mapKey = this.getMapKey(key);\\n        let hashMap = this.getHashMap(mapSymbol);\\n        return !!hashMap.containsKey(mapKey);\\n    },\\n    define(key, val) {\\n        if (this.hasButNoCall(key)) {\\n            return this.get(key);\\n        }\\n        return this.put(key, val);\\n    },\\n    defineLazy(key, lazy) {\\n        if (this.hasButNoCall(key)) {\\n            return this.get(key);\\n        }\\n        return this.put(key, lazy());\\n    },\\n    defineModule(key, path, isNew) {\\n        if(path===undefined){\\n            path=key;\\n        }\\n        if (isNew) return this.put(key, $.require(path, key));\\n        return this.defineLazy(key, () => $.require(path, key));\\n    },\\n    listKeys() {\\n        let entrySet = this.getHashMap(mapSymbol).entrySet();\\n        let selfKey = this[selfSymbol];\\n        let keys = [];\\n\\n        for (let entry of entrySet) {\\n            let key = entry.getKey();\\n            if (isString(key) && key.startsWith(selfKey)) {\\n                keys.push(String(key).replace(selfKey, \\\"\\\"));\\n            }\\n        }\\n        return keys;\\n    },\\n    toJSON() {\\n        let object = {};\\n        let hashMap = this.getHashMap(mapSymbol);\\n        let selfKey = this[selfSymbol];\\n        hashMap.forEach((key, value) => {\\n            if (!isString(key)) {\\n                return;\\n            }\\n            let keyString = String(key);\\n            if (keyString.startsWith(selfKey)) {\\n                object[keyString.replace(selfKey, \\\"\\\")] = hashMap.get(key);\\n            }\\n        });\\n        return object;\\n    }\\n});\\nGlobalVar.prototype[Symbol.iterator] = function() {\\n    let hashMap = this.getHashMap(mapSymbol);\\n    let selfKey = this[selfSymbol];\\n    let iterator = hashMap.entrySet().iterator();\\n    return (function*() {\\n        while (iterator.hasNext()) {\\n            let me = iterator.next();\\n            let key = me.getKey();\\n            if (!isString(key)) {\\n                continue;\\n            }\\n            key = String(key);\\n            if (key.startsWith(selfKey)) {\\n                yield [key.replace(selfKey, \\\"\\\"), dealWithVal(me.getValue())];\\n            }\\n        }\\n    })();\\n}\\n\\nconst GlobalMap = _globalMap;\\n//_globalMap = void 0;\\nlet RuleGlobalMapKey = (typeof MY_RULE !== \\\"undefined\\\"&&MY_RULE) ? MY_RULE.title : \\\"\\\";\\nlet AppGlobalMapKey = \\\"AppGlobalMap\\\";\\nif (RuleGlobalMapKey === AppGlobalMapKey) {\\n    let randomKey = \\\"\\\";\\n    if (GlobalMap.containsKey(0)) {\\n        randomKey = String(GlobalMap.get(0));\\n    } else {\\n        randomKey = String(Date.now());\\n        GlobalMap.put(0, randomKey);\\n    }\\n    RuleGlobalMapKey = RuleGlobalMapKey + randomKey;\\n}\\n$.exports = {\\n    GA: new GlobalVar(GlobalMap, AppGlobalMapKey),\\n    GM: new GlobalVar(GlobalMap, RuleGlobalMapKey)\\n}\"},{\"col_type\":\"movie_3\",\"name\":\"百度下载器\",\"path\":\"BaiduMultiThreadedDownloader\",\"rule\":\"//by LoyDgIk 佬\\nconst Files = java.nio.file.Files;\\nconst Paths = java.nio.file.Paths;\\nconst BufferedInputStream = java.io.BufferedInputStream\\nconst BufferedOutputStream = java.io.BufferedOutputStream\\nconst FileOutputStream = java.io.FileOutputStream;\\n//const java.util.ArrayList;\\n//const java.util.List;\\nconst ExecutorService = java.util.concurrent.ExecutorService;\\nconst Executors = java.util.concurrent.Executors;\\nconst TimeUnit = java.util.concurrent.TimeUnit\\nconst Runnable = java.lang.Runnable;\\nconst AtomicBoolean = java.util.concurrent.atomic.AtomicBoolean;\\nconst URL = java.net.URL;\\nconst Long = java.lang.Long;\\n\\nconst OkGo = com.lzy.okgo.OkGo;\\nconst HttpsUtils = com.lzy.okgo.https.HttpsUtils;\\nconst Arrays = java.util.Arrays;\\nconst Comparator = java.util.Comparator;\\nconst BUFFER_SIZE = 4096;\\nconst File = java.io.File;\\nconst Thread = java.lang.Thread;\\nconst RandomAccessFile = java.io.RandomAccessFile;\\nconst OkHttpClient = Packages.okhttp3.OkHttpClient;\\nconst FileInputStream=java.io.FileInputStream;\\n/**\\n * 使用多线程分块下载文件，支持自定义 Headers，并将分块先写入临时文件，再合并。\\n *\\n * @param url         文件下载地址\\n * @param outputPath  文件最终保存路径\\n * @param chunkSize   每个线程下载的分块大小（单位：字节）\\n * @param threadCount 下载使用的线程数\\n * @param retryCount  每个分块下载失败的最大重试次数\\n * @param headers     需要添加到请求中的自定义请求头（可为 null 表示不需要）\\n */\\nfunction downloadFile(\\n    url,\\n    outputPath,\\n    filename,\\n    config\\n) {\\n    let {\\n        chunkSize,\\n        threadCount,\\n        retryCount,\\n        headers\\n    } = config || {};\\n    let head = headers || {};\\n    chunkSize = chunkSize || 2 * 1024 * 1024;\\n    threadCount = threadCount || 4;\\n    retryCount = retryCount || 3;\\n    headers = new java.util.concurrent.ConcurrentHashMap();\\n    for (let k in head) {\\n        headers.put(k, head[k]);\\n    }\\n    let executorService = Executors.newFixedThreadPool(threadCount);\\n    \\n    let futures = []\\n    \\n    let downloadFailed = new AtomicBoolean(false);\\n\\n    \\n    let fileSize;\\n    try {\\n        let fileinfo = getFileInfo(url, head);\\n        fileSize = fileinfo.size;\\n        filename = filename || fileinfo.name || md5(url);\\n        if (!fileSize || Number.isNaN(fileSize)) {\\n            throw Error(\\\"文件大小获取失败\\\");\\n        }\\n    } catch (e) {\\n        log(\\\"获取文件大小失败: \\\" + e.toString());\\n        executorService.shutdownNow();\\n        return;\\n    }\\n    if (fileSize <= 0) {\\n        log(\\\"无法获取文件大小或文件大小为0，下载终止。\\\");\\n        executorService.shutdownNow();\\n        return;\\n    }\\n    outputPath = outputPath + \\\"/\\\" + filename;\\n\\n    let tempDir = new File(outputPath + \\\".tmp\\\");\\n    if (!tempDir.exists()) {\\n        tempDir.mkdir();\\n    }\\n\\n    let chunkCount = Math.ceil(fileSize / chunkSize);\\n    let offset = 0;\\n    for (let i = 0; i < chunkCount; i++) {\\n        // 起始位置\\n        let start = offset;\\n        // 结束位置（最后一个线程可能到 fileSize - 1 ）\\n        let end = (i == chunkCount - 1) ? (fileSize - 1) : (offset + chunkSize - 1);\\n        offset = end + 1;\\n\\n        \\n        let tempFile = new File(tempDir, \\\"chunk_\\\" + start + \\\"_\\\" + end + \\\".tmp\\\");\\n\\n        \\n        let finalStart = start;\\n        let finalEnd = end;\\n        let finalTempFile = tempFile;\\n\\n        let future = executorService.submit(new Runnable(() => {\\n            let attempts = 0;\\n            let success = false;\\n\\n            while (!downloadFailed.get() && attempts < retryCount && !success) {\\n                try {\\n                    downloadChunk(url, finalStart, finalEnd, finalTempFile, headers);\\n                    success = true;\\n                } catch (e) {\\n                    attempts++;\\n                    log(\\\"线程 \\\" + Thread.currentThread().getName() +\\n                        \\\" 下载分块 [\\\" + finalStart + \\\" - \\\" + finalEnd + \\\"] 失败，重试 \\\" +\\n                        attempts + \\\"/\\\" + retryCount + \\\"，原因：\\\" + e.toString());\\n                    if (attempts >= retryCount) {\\n                        // 标记整个下载过程失败\\n                        downloadFailed.set(true);\\n                        // 抛出异常，终止当前任务\\n                        throw new Error(\\\"线程 \\\" + Thread.currentThread().getName() +\\n                            \\\" 超出最大重试次数，下载失败。Error:\\\" + e.toString());\\n                    }\\n                }\\n            }\\n            return null;\\n        }));\\n        futures.push(future);\\n    }\\n\\n    \\n    try {\\n        for (let f of futures) {\\n            f.get(); // 如果有异常，会在这里抛出\\n        }\\n    } catch (e) {\\n        log(\\\"执行下载任务时出现异常: \\\" + e.toString());\\n        downloadFailed.set(true);\\n    } finally {\\n        // 关闭线程池\\n        executorService.shutdownNow();\\n    }\\n\\n    // 合并分块文件\\n    if (!downloadFailed.get()) {\\n        mergeChunks(tempDir, outputPath);\\n        // 删除临时文件夹及其中的文件\\n        deleteTempFiles(tempDir);\\n        log(\\\"文件下载并合并完成，保存路径：\\\" + outputPath);\\n    } else {\\n        // 如果下载失败，清空临时目录\\n        deleteTempFiles(tempDir);\\n        log(\\\"下载失败，临时文件已删除。\\\");\\n    }\\n}\\n\\nfunction getFileInfo(url, headers) {\\n    let head = JSON.parse(fetch(url, {\\n        headers: Object.assign({}, headers),\\n        onlyHeaders: true,\\n        method: \\\"HEAD\\\"\\n    })).headers;\\n    Object.keys(head).forEach(v => {\\n        head[v] = head[v][0];\\n    });\\n    let fileinfo = {\\n        md5: head[\\\"content-md5\\\"],\\n        size: Number(head[\\\"x-bs-file-size\\\"] || head[\\\"content-length\\\"]),\\n        name: /filename=\\\"(.*?)\\\"/.test(head[\\\"content-disposition\\\"]) ? RegExp.$1 : \\\"\\\"\\n    };\\n    return fileinfo;\\n}\\n\\nfunction mergeChunks(tempDir, outputPath) {\\n    let outputFile = new File(outputPath);\\n    let raf = null;\\n    try {\\n        let raf = new RandomAccessFile(outputFile, \\\"rw\\\");\\n\\n        let chunkFiles = tempDir.listFiles(new java.io.FilenameFilter((dir, name) => name.endsWith(\\\".tmp\\\")));\\n        if (chunkFiles == null) {\\n            throw new Error(\\\"无法获取临时文件夹中的分块文件。\\\");\\n        }\\n\\n        Arrays.sort(chunkFiles, Comparator.comparingLong(file => {\\n            let name = file.getName();\\n            let start = Long.parseLong(name.split(\\\"_\\\")[1]);\\n            return start;\\n        }));\\n\\n\\n        for (let chunkFile of chunkFiles) {\\n            let fis, bis;\\n            try {\\n                let fis = new FileInputStream(chunkFile);\\n                let bis = new BufferedInputStream(fis);\\n\\n                let buffer = java.lang.reflect.Array.newInstance(java.lang.Byte.TYPE, BUFFER_SIZE);\\n                let len;\\n                while ((len = bis.read(buffer)) != -1) {\\n                    raf.write(buffer, 0, len);\\n                }\\n            } finally {\\n                fis && fis.close();\\n                bis && bis.close();\\n            }\\n        }\\n    } catch (e) {\\n        log(\\\"合并分块文件时出错：\\\" + e.toString());\\n    } finally {\\n        raf && raf.close();\\n    }\\n}\\nconst downloadClient = new OkHttpClient.Builder()\\n    .connectTimeout(30, TimeUnit.SECONDS)\\n    .readTimeout(50, TimeUnit.SECONDS)\\n    .writeTimeout(40, TimeUnit.SECONDS)\\n    .sslSocketFactory(HttpsUtils.getSslSocketFactory().sSLSocketFactory, HttpsUtils.UnSafeTrustManager)\\n    .hostnameVerifier(HttpsUtils.UnSafeHostnameVerifier)\\n    .build();\\n\\nfunction downloadChunk(\\n    url,\\n    start,\\n    end,\\n    tempFile,\\n    headers\\n) {\\n\\n    let request = OkGo.get(url);\\n    // 如果有自定义 Headers，则添加\\n    if (headers != null) {\\n        for (let entry of headers.entrySet()) {\\n            request.headers(entry.getKey(), entry.getValue());\\n        }\\n    }\\n    //log(Object.keys(request))\\n    request.headers(\\\"Range\\\", \\\"bytes=\\\" + start + \\\"-\\\" + end);\\n    request.client(downloadClient);\\n    // 执行同步请求，获取响应\\n    let response = request.execute();\\n    if (response == null || ~~(response.code() / 100) != 2) {\\n        log(~~(response.code() / 100))\\n        throw new Error(\\\"服务器返回异常，HTTP code = \\\" +\\n            (response == null ? \\\"null\\\" : response.code()));\\n    }\\n\\n    // 将响应体写入临时文件\\n    let is = null,\\n        bis = null,\\n        fos = null;\\n    try {\\n        is = response.body();\\n        bis = new BufferedInputStream(is.byteStream());\\n        fos = new FileOutputStream(tempFile);\\n\\n        let buffer = java.lang.reflect.Array.newInstance(java.lang.Byte.TYPE, BUFFER_SIZE);\\n        let len;\\n        while ((len = bis.read(buffer)) != -1) {\\n            fos.write(buffer, 0, len);\\n        }\\n    } finally {\\n        is && is.close();\\n        bis && bis.close();\\n        fos && fos.close();\\n    }\\n}\\n\\nfunction deleteTempFiles(tempDir) {\\n    if (tempDir.exists() && tempDir.isDirectory()) {\\n        for (let file of tempDir.listFiles() || []) {\\n            file.delete();\\n        }\\n        tempDir.delete();\\n    }\\n}\\nlet isDownload = false;\\n$.exports.downloadFile = function(url,\\n    outputPath,\\n    filename,\\n    config) {\\n    if (isDownload) return false;\\n    isDownload=true;\\n    downloadFile(url,\\n        outputPath,\\n        filename,\\n        config);\\n    isDownload=false;\\n    return true;\\n}\\n\"}]","proxy":"","icon":"https://pannss.bdstatic.com/m-static/base/static/images/favicon.ico"}